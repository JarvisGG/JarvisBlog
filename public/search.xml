<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[SelectFrameView è§†è§‰é€‰æ‹©]]></title>
      <url>/2021/06/28/SelectFrameView%20%E8%A7%86%E8%A7%89%E9%80%89%E6%8B%A9/</url>
      <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘è°ƒç ”ä¸€ä¸ªåŠ¨æ•ˆï¼Œæ·˜å®çš„æ‹æ‘„è¯†åˆ«é€‰æ‹©ã€‚ğŸŒ°ï¼š</p>
<video width="494" height="878" controls><br>    <source src="https://raw.githubusercontent.com/JarvisGG/JarvisBlog/master/source/video/tb_select_frame.mp4"><br></video>]]></content>
      
        
        <tags>
            
            <tag> Android å¼€æºæ§ä»¶ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RecyclerView çŸ¥è¯†ç‚¹]]></title>
      <url>/2021/06/28/RecyclerView%20%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¥½ä¹…æ²¡å†™åšå®¢äº†ï¼Œåˆ°æ–°å…¬å¸å·®ä¸å¤šä¸€ä¸ªæœˆäº†ï¼Œä¹‹å‰åšAndroid TV å¼€å‘ï¼Œç°åœ¨å¼€å§‹åšæ‰‹æœºç«¯äº†ï¼Œå†™æ‰‹æœºç«¯App æˆ–è®¸æ˜¯ä¸€ä¸ªå¾ˆä¹…çš„æ‰§å¿µå§ã€‚<br>å°±æœ€è¿‘çš„é¡µé¢éœ€æ±‚ï¼Œå¥½å¥½ç ”ç©¶äº†ä¸€ä¸‹ViewGroupï¼ŒRecyclerView çš„ç»˜åˆ¶ï¼Œè¿™é‡Œæ‰“ç®—ç«‹ä¸ªflagï¼Œè®°ä¸€ä¸‹è‡ªå·±è¸©çš„å‘ã€‚<br>å…ˆç«‹ä¸ªè‡ªå·±çš„æ€è·¯ï¼š<br><strong><em>è¿™é‡Œå†æè®®å˜´ï¼Œä¸€èˆ¬æˆ‘ä»¬å¤„ç†ä¸€ä¸ªviewçš„UIäº¤äº’ï¼ŒåŠ¨æ•ˆï¼Œæœ€å¥½æ¥å°è£…æ§ä»¶ï¼Œä»æˆ‘ä»¬çš„mvpï¼Œmvvmç­‰ç­‰æ¨¡å¼é‡ŒæŠ½ç¦»åŠ¨ç”»ï¼Œäº¤äº’çš„å…·ä½“ä»£ç ï¼ï¼ï¼ï¼ï¼ï¼ï¼</em></strong></p>
<h2 id="æœ€è¿‘çš„ä¸€ä¸ªéœ€æ±‚"><a href="#æœ€è¿‘çš„ä¸€ä¸ªéœ€æ±‚" class="headerlink" title="æœ€è¿‘çš„ä¸€ä¸ªéœ€æ±‚"></a>æœ€è¿‘çš„ä¸€ä¸ªéœ€æ±‚</h2><p>æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå¦‚è§†é¢‘æ‰€ç¤ºï¼š<br><a id="more"></a></p>
<video width="494" height="878" controls><br>    <source src="https://raw.githubusercontent.com/JarvisGG/JarvisBlog/master/source/video/demo.mp4"><br></video>

<p>å¦‚å›¾æ‰€ç¤ºåŠ¨ç”»è¿‡ç¨‹ï¼š<br>1.ä¸Šä¸‹æ»šåŠ¨æ˜¯ï¼Œåº•å›¾æ˜¯è·Ÿç€æµ®åŠ¨çš„ï¼ˆitemä»å¤´åˆ°å°¾æ»‘åŠ¨recycerviewçš„é«˜åº¦ï¼Œä½†æ˜¯å›¾ç‰‡éœ€è¦æ»šåŠ¨å…¨å±è·ç¦»ï¼‰.<br>2.ç‚¹å‡»itemï¼Œåˆ—è¡¨å±•å¼€.<br>3.åº•å›¾æ”¾å¤§åˆ°å…¨å±.</p>
<h2 id="æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹"><a href="#æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹" class="headerlink" title="æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹"></a>æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹</h2><h3 id="itemDecoration-æ˜¯ä»€ä¹ˆ"><a href="#itemDecoration-æ˜¯ä»€ä¹ˆ" class="headerlink" title="itemDecoration æ˜¯ä»€ä¹ˆ"></a>itemDecoration æ˜¯ä»€ä¹ˆ</h3><p>è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹çœ‹æºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemDecoration</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">        onDraw(c, parent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Deprecated</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas c, RecyclerView parent)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawOver</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">        onDrawOver(c, parent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Deprecated</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawOver</span><span class="params">(Canvas c, RecyclerView parent)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Deprecated</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getItemOffsets</span><span class="params">(Rect outRect, <span class="keyword">int</span> itemPosition, RecyclerView parent)</span> </span>&#123;</div><div class="line">        outRect.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getItemOffsets</span><span class="params">(Rect outRect, View view, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">        getItemOffsets(outRect, ((LayoutParams) view.getLayoutParams()).getViewLayoutPosition(),</div><div class="line">                parent);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æ˜¯ç›´æ¥åœ¨<strong>recyclerviewçš„ç”»å¸ƒä¸Šç”¨Canvas</strong>ç”»å‡ºæ¥çš„ï¼Œè¿™åœ°æ–¹å¾ˆé‡è¦ã€‚</p>
<h3 id="ItemView-çš„ç»˜åˆ¶"><a href="#ItemView-çš„ç»˜åˆ¶" class="headerlink" title="ItemView çš„ç»˜åˆ¶"></a>ItemView çš„ç»˜åˆ¶</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹æºç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getChildDrawingOrder</span><span class="params">(<span class="keyword">int</span> childCount, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.getChildDrawingOrder(childCount, i);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥é€šè¿‡æ§åˆ¶è¿™ä¸ªæ–¹æ³•æ¥å†³å®šrecyclerview itemviewçš„ç»˜åˆ¶é¡ºåº<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.dispatchDraw(canvas);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæ˜¯å…·ä½“æ‰§è¡Œrecyclerview ç»˜åˆ¶itemviewçš„åœ°æ–¹<br>ä¹‹å‰æˆ‘åœ¨åšrecyclerview itemviewæ»‘åˆ°å±å¹•ä¸­é—´çš„æ—¶å€™æ”¾å¤§ï¼Œç”±äºitemviewçš„ç»˜åˆ¶é¡ºåºï¼Œæ”¾å¤§çš„itemviewä¼šè¢«åé¢çš„itemviewç›–ä½ï¼Œè¿™é‡Œæˆ‘é€šè¿‡å¤å†™è¿™ä¸ªæ–¹æ³•æ¥å®Œæˆã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChildAttachedToWindow</span><span class="params">(View child)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.post(() -&gt; &#123;</div><div class="line">        <span class="keyword">if</span> (child <span class="keyword">instanceof</span> ContainerCardView) &#123;</div><div class="line">            mContainerCardView.put((ContainerCardView) child, TopRecyclerView.<span class="keyword">this</span>.getChildAdapterPosition(child));</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">super</span>.onChildAttachedToWindow(child);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç¬¬ä¸€éç»˜åˆ¶æ‰€æœ‰view</span></div><div class="line">    <span class="keyword">super</span>.dispatchDraw(canvas);</div><div class="line">    <span class="comment">// å¼€å§‹ç»˜åˆ¶ç‰¹å®šviewï¼Œä¿è¯å±‚çº§æœ€é«˜</span></div><div class="line">    List&lt;ContainerCardView&gt; crashChildViews = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    crashChildViews.addAll(mContainerCardView.keySet());</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; crashChildViews.size(); i++) &#123;</div><div class="line">        <span class="keyword">super</span>.drawChild(canvas, crashChildViews.get(i), <span class="keyword">this</span>.getDrawingTime());</div><div class="line">        crashChildViews.get(i).setTag(<span class="string">"draw"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>itemviewçš„layout<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLayoutChildren</span><span class="params">(Recycler recycler, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onLayoutChildren(recycler, state);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="recyclerviewï¼ˆViewGroupï¼‰-ä»¥åŠ-itemview-é‡ç»˜"><a href="#recyclerviewï¼ˆViewGroupï¼‰-ä»¥åŠ-itemview-é‡ç»˜" class="headerlink" title="recyclerviewï¼ˆViewGroupï¼‰ ä»¥åŠ itemview é‡ç»˜"></a>recyclerviewï¼ˆViewGroupï¼‰ ä»¥åŠ itemview é‡ç»˜</h3><p>å¯¹äºé‡ç»˜æˆ‘ä»¬åº”è¯¥å¤šåšæ³¨æ„ï¼š<br>1.é¢‘ç¹é‡ç»˜ï¼Œä¼šå¯¼è‡´vsyncä¿¡å·é—´éš”ï¼Œgpuæ¥ä¸åŠç»˜åˆ¶framequeueé‡Œé¢çš„framesï¼Œå¯¼è‡´ä¸¢å¸§ã€‚<br>2.itemview é‡ç»˜ä¼šå¯¼è‡´Android TVç„¦ç‚¹ä¸¢å¤±ã€‚<br>3.itemview é‡ç»˜ï¼Œå‡å¦‚å¤–å±‚çš„viewgroupæ˜¯wrapcontentï¼Œå°†ä¼šå¯¼è‡´é€’å½’åˆ°æ ¹èŠ‚ç‚¹ï¼ˆå®½é«˜ç»™æ­»çš„viewgroupï¼‰çš„æ‰€æœ‰viewé‡ç»˜ã€‚å‡å¦‚å…¶ä¸­æœ‰layoutä½ç½®åŠ¨ç”»ï¼Œå°†ä¼šå¯¼è‡´åŠ¨ç”»å¤±æ•ˆã€‚<br>4.é¿å…å­viewé‡ç»˜åˆ¶å¯¼è‡´ä¸Šå±‚è·Ÿç€é‡ç»˜åˆ¶ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ç»™å®šä¸Šå±‚viewgroupå›ºå®šçš„æ¡†é«˜ï¼Œä»»ä½ å­viewå˜åŒ–è«æµ‹ï¼Œæˆ‘å²¿ç„¶ä¸åŠ¨ï¼Œè¿™æ ·å°±å¯ä»¥ä¿å­˜ä¸€äº›layoutçš„åŠ¨ç”»çŠ¶æ€ã€‚</p>
<h2 id="å…·ä½“çš„å®ç°æ–¹å¼"><a href="#å…·ä½“çš„å®ç°æ–¹å¼" class="headerlink" title="å…·ä½“çš„å®ç°æ–¹å¼"></a>å…·ä½“çš„å®ç°æ–¹å¼</h2><h3 id="æ‹†åˆ†åŠ¨ç”»"><a href="#æ‹†åˆ†åŠ¨ç”»" class="headerlink" title="æ‹†åˆ†åŠ¨ç”»"></a>æ‹†åˆ†åŠ¨ç”»</h3><h4 id="recyclerview-å±•å¼€ï¼Œæ”¶ç¼©åŠ¨ç”»ï¼š"><a href="#recyclerview-å±•å¼€ï¼Œæ”¶ç¼©åŠ¨ç”»ï¼š" class="headerlink" title="recyclerview å±•å¼€ï¼Œæ”¶ç¼©åŠ¨ç”»ï¼š"></a>recyclerview å±•å¼€ï¼Œæ”¶ç¼©åŠ¨ç”»ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * å±•å¼€åŠ¨ç”»</div><div class="line">    * <span class="doctag">@param</span> childView</div><div class="line">    * <span class="doctag">@param</span> selectedPosition</div><div class="line">    */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">excuteExtendAnim</span><span class="params">(View childView, <span class="keyword">int</span> selectedPosition)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.mTargetView = childView;</div><div class="line">    <span class="keyword">this</span>.mSelectPosition = selectedPosition;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> screenPosition[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">    childView.getLocationOnScreen(screenPosition);</div><div class="line"></div><div class="line">    List&lt;Animator&gt; excuteChildAnim = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    List&lt;View&gt; excuteChilds = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</div><div class="line">        View child = <span class="keyword">this</span>.getChildAt(i);</div><div class="line">        <span class="keyword">int</span> position = getChildAdapterPosition(child);</div><div class="line">        <span class="keyword">if</span> (position &lt; selectedPosition) &#123;</div><div class="line">            excuteChilds.add(child);</div><div class="line">            <span class="keyword">final</span> ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(child, View.TRANSLATION_Y, <span class="number">0</span>, -screenPosition[<span class="number">1</span>] + mParentScreenPosition[<span class="number">1</span>]);</div><div class="line">            objectAnimator.setDuration(mDuration);</div><div class="line">            excuteChildAnim.add(objectAnimator);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position &gt; selectedPosition) &#123;</div><div class="line">            excuteChilds.add(child);</div><div class="line">            <span class="keyword">final</span> ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(child, View.TRANSLATION_Y, <span class="number">0</span>, Utils.getScreenSizeY(mContext) - screenPosition[<span class="number">1</span>] - childView.getHeight());</div><div class="line">            objectAnimator.setDuration(mDuration);</div><div class="line">            excuteChildAnim.add(objectAnimator);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    excuteItemAnim(excuteChildAnim, <span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * æ”¶ç¼©åŠ¨ç”»</div><div class="line">    */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">excuteShrinkAnim</span><span class="params">()</span> </span>&#123;</div><div class="line">    List&lt;Animator&gt; excuteChildAnim = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</div><div class="line">        View child = <span class="keyword">this</span>.getChildAt(i);</div><div class="line">        <span class="keyword">int</span> position = getChildAdapterPosition(child);</div><div class="line">        <span class="keyword">if</span> (position != mSelectPosition) &#123;</div><div class="line">            <span class="keyword">float</span> startY = child.getTranslationY();</div><div class="line">            <span class="keyword">final</span> ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(child, View.TRANSLATION_Y, startY, <span class="number">0</span>);</div><div class="line">            objectAnimator.setDuration(<span class="number">200</span>);</div><div class="line">            excuteChildAnim.add(objectAnimator);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    excuteItemAnim(excuteChildAnim, <span class="keyword">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">excuteItemAnim</span><span class="params">(List&lt;Animator&gt; excuteChildAnim, <span class="keyword">boolean</span> isShrink)</span> </span>&#123;</div><div class="line"></div><div class="line">    AnimatorSet set = <span class="keyword">new</span> AnimatorSet();</div><div class="line">    set.playTogether(excuteChildAnim);</div><div class="line">    set.setInterpolator(<span class="keyword">new</span> DecelerateInterpolator());</div><div class="line">    set.start();</div><div class="line">    notifyAnimStateStart(<span class="keyword">null</span>, !isShrink);</div><div class="line">    set.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line">            notifyAnimStateEnd(animator, !isShrink);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line">            notifyAnimStateCancel(animator, !isShrink);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line">            notifyAnimStateRepeat(animator, !isShrink);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="recyclerview-æ»šåŠ¨ï¼Œitemview-çš„imageview-çš„ç§»åŠ¨åŠ¨ç”»ï¼š"><a href="#recyclerview-æ»šåŠ¨ï¼Œitemview-çš„imageview-çš„ç§»åŠ¨åŠ¨ç”»ï¼š" class="headerlink" title="recyclerview æ»šåŠ¨ï¼Œitemview çš„imageview çš„ç§»åŠ¨åŠ¨ç”»ï¼š"></a>recyclerview æ»šåŠ¨ï¼Œitemview çš„imageview çš„ç§»åŠ¨åŠ¨ç”»ï¼š</h4><p>recyclerviewï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * å®šä¹‰æ¥å£</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ScrollStateCallback</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> newState)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrolled</span><span class="params">(<span class="keyword">int</span> headerHeight, <span class="keyword">int</span> totalHeight, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span></span>;</div><div class="line">&#125;</div><div class="line">ï¼**</div><div class="line"> * å°†å®ç°è¿™ä¸ªæ¥å£çš„cardview æ·»åŠ åˆ°é›†åˆ</div><div class="line"> *ï¼</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChildAttachedToWindow</span><span class="params">(View child)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onChildAttachedToWindow(child);</div><div class="line">    <span class="keyword">if</span> (child <span class="keyword">instanceof</span> ScrollStateCallback) &#123;</div><div class="line">        mScrollStateCallback.add((ScrollStateCallback) child);</div><div class="line">    &#125;</div><div class="line">    initChildOperator(child);</div><div class="line">&#125;</div><div class="line">ï¼**</div><div class="line"> * å°†å®ç°è¿™ä¸ªæ¥å£çš„cardview ç§»é™¤é›†åˆ</div><div class="line"> *ï¼</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChildDetachedFromWindow</span><span class="params">(View child)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onChildDetachedFromWindow(child);</div><div class="line">    <span class="keyword">if</span> (child <span class="keyword">instanceof</span> ScrollStateCallback) &#123;</div><div class="line">        mScrollStateCallback.remove(child);</div><div class="line">    &#125;</div><div class="line">    detachChildOperator(child);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.mContext = context;</div><div class="line">    <span class="keyword">this</span>.addOnScrollListener(<span class="keyword">new</span> OnScrollListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> newState)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onScrollStateChanged(recyclerView, newState);</div><div class="line">            notifyScrollStateChanged(recyclerView, newState); <span class="comment">// å¼€å§‹è°ƒç”¨æ–¹æ³•</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrolled</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onScrolled(recyclerView, dx, dy);</div><div class="line">            notifyScrolled(recyclerView, dx, dy);<span class="comment">// å¼€å§‹è°ƒç”¨Scrollæ–¹æ³•</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyScrolled</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (ScrollStateCallback callback : mScrollStateCallback) &#123;</div><div class="line">        callback.onScrolled(mHeaderHeight, mTotalHeight, dx, dy);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> newState)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (ScrollStateCallback callback : mScrollStateCallback) &#123;</div><div class="line">        callback.onScrollStateChanged(recyclerView, newState);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>cardview ç»§æ‰¿ ScrollStateCallback:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> newState)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrolled</span><span class="params">(<span class="keyword">int</span> mHeaderHeight, <span class="keyword">int</span> mTotalHeight, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">    excuteAdCardAnim(mHeaderHeight, mTotalHeight, dx, dy);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ•°å­¦å…¬å¼æ¨å€’</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">excuteAdCardAnim</span><span class="params">(<span class="keyword">int</span> mHeaderHeight, <span class="keyword">int</span> mTotalHeight, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> topOffset = <span class="keyword">this</span>.getTop();</div><div class="line">    <span class="keyword">int</span> a = topOffset + mHeaderHeight;</div><div class="line">    <span class="keyword">int</span> b = topOffset * mTotalHeight;</div><div class="line">    <span class="keyword">int</span> c = mTotalHeight - mHeaderHeight;</div><div class="line">    <span class="keyword">int</span> top = a - b / c - mHeaderHeight;</div><div class="line">    <span class="keyword">if</span> (top &gt; <span class="number">0</span>) &#123;</div><div class="line">        top = topOffset;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è¿™é‡Œè¦æ³¨æ„æˆ‘åˆšæ‰æå‡ºçš„é‡å›é—®é¢˜ï¼Œä¸ç„¶è¿™å—å„¿çš„åŠ¨ç”»ä¼šå› ä¸ºé‡ç»˜åˆ¶å¤±æ•ˆ</span></div><div class="line">    <span class="keyword">this</span>.mImageView.dragPosition(</div><div class="line">            mImageView.getLeft(),</div><div class="line">            top - topOffset,</div><div class="line">            mImageView.getRight(),</div><div class="line">            top + mImageView.getHeight() - topOffset);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="å…³é”®çš„åŠ¨ç”»å·²ç»åŸºæœ¬å®Œæˆï¼Œç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸Šè®¿çš„titlebarä¹Ÿè¦åŠ¨ç”»ï¼Œæ¶ˆå¤±ï¼Œè¿™é‡Œå°±ä¸åˆ—å‡ºä»£ç äº†ï¼Œå¾ˆç®€å•ï¼Œé—®é¢˜æ˜¯æˆ‘çš„recyclerview-çš„ç›®æ ‡itemview-éœ€è¦ä¹Ÿä¿æŒç§»åŠ¨æ¥ä¿è¯è·Ÿåé¢çš„imageviewä¿æŒä¸€è‡´ï¼š"><a href="#å…³é”®çš„åŠ¨ç”»å·²ç»åŸºæœ¬å®Œæˆï¼Œç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸Šè®¿çš„titlebarä¹Ÿè¦åŠ¨ç”»ï¼Œæ¶ˆå¤±ï¼Œè¿™é‡Œå°±ä¸åˆ—å‡ºä»£ç äº†ï¼Œå¾ˆç®€å•ï¼Œé—®é¢˜æ˜¯æˆ‘çš„recyclerview-çš„ç›®æ ‡itemview-éœ€è¦ä¹Ÿä¿æŒç§»åŠ¨æ¥ä¿è¯è·Ÿåé¢çš„imageviewä¿æŒä¸€è‡´ï¼š" class="headerlink" title="å…³é”®çš„åŠ¨ç”»å·²ç»åŸºæœ¬å®Œæˆï¼Œç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸Šè®¿çš„titlebarä¹Ÿè¦åŠ¨ç”»ï¼Œæ¶ˆå¤±ï¼Œè¿™é‡Œå°±ä¸åˆ—å‡ºä»£ç äº†ï¼Œå¾ˆç®€å•ï¼Œé—®é¢˜æ˜¯æˆ‘çš„recyclerview çš„ç›®æ ‡itemview éœ€è¦ä¹Ÿä¿æŒç§»åŠ¨æ¥ä¿è¯è·Ÿåé¢çš„imageviewä¿æŒä¸€è‡´ï¼š"></a>å…³é”®çš„åŠ¨ç”»å·²ç»åŸºæœ¬å®Œæˆï¼Œç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸Šè®¿çš„titlebarä¹Ÿè¦åŠ¨ç”»ï¼Œæ¶ˆå¤±ï¼Œè¿™é‡Œå°±ä¸åˆ—å‡ºä»£ç äº†ï¼Œå¾ˆç®€å•ï¼Œé—®é¢˜æ˜¯æˆ‘çš„recyclerview çš„ç›®æ ‡itemview éœ€è¦ä¹Ÿä¿æŒç§»åŠ¨æ¥ä¿è¯è·Ÿåé¢çš„imageviewä¿æŒä¸€è‡´ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Ad.Creative creative, <span class="keyword">boolean</span> isShrink)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.mCreative = creative;</div><div class="line">    mZHFloatAdFullView.setCreative(mCreative);</div><div class="line">    AnimatorSet set = <span class="keyword">new</span> AnimatorSet();</div><div class="line">    List&lt;Animator&gt; animatorList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isShrink) &#123;</div><div class="line"></div><div class="line">        ValueAnimator downAnim = ValueAnimator.ofInt(<span class="number">0</span>, mLastTopHeight);</div><div class="line">        downAnim.addUpdateListener(<span class="keyword">new</span> AdLogoViewAnimatorUpdateListener(mLastTopHeight, mLastItemHeight));</div><div class="line">        animatorList.add(downAnim);</div><div class="line"></div><div class="line">        ObjectAnimator parentAnim = ObjectAnimator.ofFloat(<span class="keyword">this</span>, View.TRANSLATION_Y, <span class="number">0</span>);</div><div class="line">        animatorList.add(parentAnim);</div><div class="line"></div><div class="line">        ZHFloatAdCardView cardView = mZHFloatAdRecyclerView.getCurrentClickView();</div><div class="line">        ObjectAnimator clickAnim = ObjectAnimator.ofFloat(cardView, View.TRANSLATION_Y, <span class="number">0</span>);</div><div class="line">        animatorList.add(clickAnim);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> currentTop = mZHFloatAdRecyclerView.getCurrentAnimItemLogoViewTop();</div><div class="line">        mLastTopHeight = currentTop;</div><div class="line">        mLastItemHeight = mZHFloatAdRecyclerView.getCurrentAnimItemMargetTop();</div><div class="line"></div><div class="line">        ValueAnimator upAnim = ValueAnimator.ofInt(currentTop, <span class="number">0</span>);</div><div class="line">        upAnim.addUpdateListener(<span class="keyword">new</span> AdLogoViewAnimatorUpdateListener(mLastTopHeight, mLastItemHeight));</div><div class="line">        animatorList.add(upAnim);</div><div class="line"></div><div class="line">        ObjectAnimator parentAnim = ObjectAnimator.ofFloat(<span class="keyword">this</span>, View.TRANSLATION_Y,  -mHeaderHeight);</div><div class="line">        animatorList.add(parentAnim);</div><div class="line"></div><div class="line">        ZHFloatAdCardView cardView = mZHFloatAdRecyclerView.getCurrentClickView();</div><div class="line">        ObjectAnimator clickAnim = ObjectAnimator.ofFloat(cardView, View.TRANSLATION_Y, -currentTop);</div><div class="line">        animatorList.add(clickAnim);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    set.playTogether(animatorList);</div><div class="line">    set.setInterpolator(<span class="keyword">new</span> AccelerateDecelerateInterpolator());</div><div class="line">    set.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line">            Log.e(<span class="string">"topOffset ------&gt; "</span>, ZHFloatAdFloatView.<span class="keyword">this</span>.getTop()+<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animator)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    set.setDuration(sAdNormalAnimDuration);</div><div class="line">    set.start();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdLogoViewAnimatorUpdateListener</span> <span class="keyword">implements</span> <span class="title">ValueAnimator</span>.<span class="title">AnimatorUpdateListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> totalTop;</div><div class="line">    <span class="keyword">int</span> itemTop;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AdLogoViewAnimatorUpdateListener</span><span class="params">(<span class="keyword">int</span> totalTop, <span class="keyword">int</span> itemTop)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.totalTop = totalTop;</div><div class="line">        <span class="keyword">this</span>.itemTop = itemTop;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator valueAnimator)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> top = (<span class="keyword">int</span>)valueAnimator.getAnimatedValue();</div><div class="line">        <span class="keyword">if</span> (mZHFloatAdRecyclerView.getCurrentClickAdCardType() == ZHFloatAdCardView.ADCardViewType.FLOAT) &#123;</div><div class="line">            mAdLogoView.dragPosition(</div><div class="line">                    mAdLogoView.getLeft(),</div><div class="line">                    top,</div><div class="line">                    mAdLogoView.getRight(),</div><div class="line">                    top + mAdLogoView.getHeight());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ‰‹åŠ¿æ§åˆ¶"><a href="#æ‰‹åŠ¿æ§åˆ¶" class="headerlink" title="æ‰‹åŠ¿æ§åˆ¶"></a>æ‰‹åŠ¿æ§åˆ¶</h3><p>å±•å¼€ç¬¬äºŒçº§é¡µé¢ï¼Œæˆ‘ä»¬è¦ç›‘æ§æ‰‹åŠ¿ï¼Œå¾€ä¸Šæ»‘ï¼Œå°±æ§åˆ¶æ»‘åŠ¨åˆ°webviewï¼Œåœ¨webviewçŠ¶æ€æƒ³ä¸Šæ»‘ï¼Œå°±æ»‘åˆ°é¡¶éƒ¨ï¼Œæ¼å‡ºimageviewã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isOvering) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (mCurrent == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (mWebView.getScrollY() == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> ACTION_DOWN:</div><div class="line">                lastY = y = ev.getY();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> ACTION_MOVE:</div><div class="line">                y = ev.getY();</div><div class="line">                deltaY = (<span class="keyword">int</span>) (lastY - y);</div><div class="line">                <span class="keyword">if</span> (deltaY &lt; -mTouchThreshold) &#123;</div><div class="line">                    isOvering = <span class="keyword">true</span>;</div><div class="line">                    mZHFloatAdFloatView.excuteScrollAnim(mContext, <span class="keyword">this</span>, <span class="keyword">false</span>,</div><div class="line">                            () -&gt; &#123;</div><div class="line">                        isOvering = <span class="keyword">false</span>;</div><div class="line">                        setCurrent(<span class="number">0</span>);</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> ACTION_UP:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isOvering) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (mCurrent == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> ACTION_DOWN:</div><div class="line">                lastY = y = event.getY();</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">case</span> ACTION_MOVE:</div><div class="line">                y = event.getY();</div><div class="line">                deltaY = (<span class="keyword">int</span>) (lastY - y);</div><div class="line">                <span class="keyword">if</span> (deltaY &gt; mTouchThreshold) &#123;</div><div class="line">                    isOvering = <span class="keyword">true</span>;</div><div class="line">                    mZHFloatAdFloatView.excuteScrollAnim(mContext, <span class="keyword">this</span>, <span class="keyword">true</span>,</div><div class="line">                            () -&gt; &#123;</div><div class="line">                                isOvering = <span class="keyword">false</span>;</div><div class="line">                                setCurrent(<span class="number">1</span>);</div><div class="line">                            &#125;);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> ACTION_UP:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡ŒTouchäº‹ä»¶çš„ä¼ é€’æ–¹å¼å°±ä¸è¯´äº†ã€‚è‡ªè¡Œgoogleã€‚</p>
<h3 id="webviewçš„åŸºæœ¬é…ç½®"><a href="#webviewçš„åŸºæœ¬é…ç½®" class="headerlink" title="webviewçš„åŸºæœ¬é…ç½®"></a>webviewçš„åŸºæœ¬é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initWebSettings</span><span class="params">()</span> </span>&#123;</div><div class="line">    WebSettings settings = mWebView.getSettings();</div><div class="line">    <span class="comment">//æ”¯æŒJS</span></div><div class="line">    settings.setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">    <span class="comment">//æ”¯æŒæ’ä»¶</span></div><div class="line">    settings.setPluginState(WebSettings.PluginState.ON);</div><div class="line">    <span class="comment">//è®¾ç½®é€‚åº”å±å¹•</span></div><div class="line">    settings.setUseWideViewPort(<span class="keyword">true</span>);</div><div class="line">    settings.setLoadWithOverviewMode(<span class="keyword">true</span>);</div><div class="line">    <span class="comment">//æ”¯æŒç¼©æ”¾</span></div><div class="line">    settings.setSupportZoom(<span class="keyword">false</span>);</div><div class="line">    <span class="comment">//éšè—åŸç”Ÿçš„ç¼©æ”¾æ§ä»¶</span></div><div class="line">    settings.setDisplayZoomControls(<span class="keyword">false</span>);</div><div class="line">    <span class="comment">//æ”¯æŒå†…å®¹é‡æ–°å¸ƒå±€</span></div><div class="line">    settings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.NORMAL);</div><div class="line">    settings.supportMultipleWindows();</div><div class="line">    settings.setSupportMultipleWindows(<span class="keyword">true</span>);</div><div class="line">    <span class="comment">//è®¾ç½®ç¼“å­˜æ¨¡å¼</span></div><div class="line">    settings.setDomStorageEnabled(<span class="keyword">true</span>);</div><div class="line">    settings.setDatabaseEnabled(<span class="keyword">true</span>);</div><div class="line">    settings.setCacheMode(WebSettings.LOAD_DEFAULT);</div><div class="line">    settings.setAppCacheEnabled(<span class="keyword">true</span>);</div><div class="line">    settings.setAppCachePath(mWebView.getContext().getCacheDir().getAbsolutePath());</div><div class="line"></div><div class="line">    <span class="comment">//è®¾ç½®å¯è®¿é—®æ–‡ä»¶</span></div><div class="line">    settings.setAllowFileAccess(<span class="keyword">true</span>);</div><div class="line">    <span class="comment">//æ”¯æŒè‡ªåŠ¨åŠ è½½å›¾ç‰‡</span></div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">        settings.setLoadsImagesAutomatically(<span class="keyword">true</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        settings.setLoadsImagesAutomatically(<span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è®¾ç½®ç¼–ç æ ¼å¼</span></div><div class="line">    settings.setDefaultTextEncodingName(<span class="string">"UTF-8"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initWebViewClient</span><span class="params">()</span> </span>&#123;</div><div class="line">    mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line"></div><div class="line">        <span class="comment">//é¡µé¢å¼€å§‹åŠ è½½æ—¶</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onPageStarted(view, url, favicon);</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//é¡µé¢å®ŒæˆåŠ è½½æ—¶</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onPageFinished(view, url);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//æ˜¯å¦åœ¨WebViewå†…åŠ è½½æ–°é¡µé¢</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, request);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (url.contains(HTTP) || url.contains(HTTPS)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, url);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (UriHandlerDispatcher.handleUri(getContext(), url)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, url);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//ç½‘ç»œé”™è¯¯æ—¶å›è°ƒçš„æ–¹æ³•</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceError error)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onReceivedError(view, request, error);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedHttpError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceResponse errorResponse)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onReceivedHttpError(view, request, errorResponse);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doUpdateVisitedHistory</span><span class="params">(WebView view, String url, <span class="keyword">boolean</span> isReload)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.doUpdateVisitedHistory(view, url, isReload);</div><div class="line">            mWebView.clearHistory(); <span class="comment">// ä¸ä¿å­˜å†å²ï¼Œä¸å…è®¸goBack</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initWebChromeClient</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    mWebView.setWebChromeClient(<span class="keyword">new</span> WebChromeClient() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedTitle</span><span class="params">(WebView view, String title)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onReceivedTitle(view, title);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(WebView view, <span class="keyword">int</span> newProgress)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onProgressChanged(view, newProgress);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getDefaultVideoPoster</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.getDefaultVideoPoster();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¹‹å‰èµ°äº†ä¸å°‘å‘ã€‚è¿™ä¸ªæ˜¯PlanB+ï¼Œä¹‹å‰çš„å¿ƒè·¯å†ç¨‹PlanA -&gt; PlanB -&gt; PlanC -&gt; PlanB+ã€‚ğŸ˜‚<br>å¥½åœ¨çœ‹äº†ä¸å°‘æºç ï¼Œæ„Ÿè§‰æ”¶è·æŒºå¤§çš„ã€‚åç»­æ‰“ç®—è¿˜æ˜¯ç»§ç»­ç»“åˆå…·ä½“éœ€æ±‚ï¼Œæ•´ç†è®°å½•çŸ¥è¯†ç‚¹å„¿ã€‚</p>
]]></content>
      
        
        <tags>
            
            <tag> Android View </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[NestTouchScrollingLayout æ— ç¼æ‹–æ‹½çš„ Layout]]></title>
      <url>/2018/12/05/NestTouchScrollingLayout%20%E6%97%A0%E7%BC%9D%E6%BB%91%E5%8A%A8%E7%9A%84%20Layout/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¹´å¹´åˆæ¥è§¦å›ç­”é¡µé¢æ”¹ç‰ˆï¼Œç”±ä¹‹å‰çš„å·¦å³æ»‘åŠ¨å›ç­”æ”¹ä¸ºä¸Šä¸‹æ»‘åŠ¨å›ç­”ï¼Œç”±äºå½“æ—¶å›ç­”é¡µçš„ä»£ç å¤ªè¿‡äºåºå¤§ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡æ”¹ç‰ˆå¤ç”¨äº†ä¹‹å‰çš„ UI æ¡†æ¶ï¼Œå¤–å±‚ ViewPager + Fragmentï¼Œå†…å±‚æ˜¯ WebView åµŒå¥— Hybrid é¡µé¢ã€‚</p>
<p>é—®é¢˜å‡ºç°äº†ï¼ŒWebView å¯ä»¥æ»šåŠ¨çš„æ—¶å€™ï¼Œä¼šæŒæœ‰æ•´ä¸ª Touch äº‹ä»¶æµç¨‹ï¼Œå¯¼è‡´å½“ webView æ‹–æ‹½åˆ°åº•éƒ¨ï¼Œæ‰‹æŒ‡ä¸è„±ç¦»å±å¹•ç»§ç»­æ‹–æ‹½çš„æ—¶å€™ï¼Œæ— æ³•å°†å½“å‰çš„æ‹–æ‹½æ“ä½œç»™ç¿»é¡µå™¨ï¼Œäº§ç”Ÿä½“éªŒä¸Šçš„å‰²è£‚æ„Ÿã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ UI äº¤äº’ä¼˜åŒ–çš„å†ç¨‹<br><a id="more"></a></p>
<h2 id="è°ƒç ”"><a href="#è°ƒç ”" class="headerlink" title="è°ƒç ”"></a>è°ƒç ”</h2><h3 id="1-NestedScrolling"><a href="#1-NestedScrolling" class="headerlink" title="1.NestedScrolling:"></a>1.NestedScrolling:</h3><p>Support V4 æä¾›äº†ä¸€å¥— API æ¥æ”¯æŒåµŒå…¥çš„æ»‘åŠ¨æ•ˆæœã€‚NestedScrolling æä¾›äº†ä¸€å¥—çˆ¶ View å’Œå­ View æ»‘åŠ¨äº¤äº’æœºåˆ¶ã€‚è¦å®Œæˆè¿™æ ·çš„äº¤äº’ï¼Œçˆ¶ View éœ€è¦å®ç° NestedScrollingParent æ¥å£ï¼Œè€Œå­ View éœ€è¦å®ç° NestedScrollingChild æ¥å£ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªå¯ä»¥åµŒå…¥ NestedScrollingChild çš„çˆ¶ Viewï¼Œéœ€è¦å®ç° NestedScrollingParentï¼Œè¿™ä¸ªæ¥å£æ–¹æ³•å’Œ NestedScrollingChild å¤§è‡´æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚åŒæ ·ï¼Œä¹Ÿæœ‰ä¸€ä¸ª NestedScrollingParentHelper è¾…åŠ©ç±»æ¥é»˜é»˜çš„å¸®åŠ©ä½ å®ç°å’Œ Child äº¤äº’çš„é€»è¾‘ã€‚æ»‘åŠ¨åŠ¨ä½œæ˜¯ Child ä¸»åŠ¨å‘èµ·ï¼ŒParent å°±æ”¶æ»‘åŠ¨å›è°ƒå¹¶ä½œå‡ºå“åº”ã€‚</p>
<p>ä»ä¸Šé¢çš„ Child åˆ†æå¯çŸ¥ï¼Œæ»‘åŠ¨å¼€å§‹çš„è°ƒç”¨ startNestedScroll()ï¼ŒParent æ”¶åˆ° onStartNestedScroll() å›è°ƒï¼Œå†³å®šæ˜¯å¦éœ€è¦é…åˆ Child ä¸€èµ·è¿›è¡Œå¤„ç†æ»‘åŠ¨ï¼Œå¦‚æœéœ€è¦é…åˆï¼Œè¿˜ä¼šå›è°ƒ onNestedScrollAccepted()ã€‚</p>
<p>æ¯æ¬¡æ»‘åŠ¨å‰ï¼ŒChild å…ˆè¯¢é—® Parent æ˜¯å¦éœ€è¦æ»‘åŠ¨ï¼Œå³ dispatchNestedPreScroll()ï¼Œè¿™å°±å›è°ƒåˆ° Parent çš„ onNestedPreScroll()ï¼ŒParent å¯ä»¥åœ¨è¿™ä¸ªå›è°ƒä¸­â€œåŠ«æŒâ€æ‰ Child çš„æ»‘åŠ¨ï¼Œä¹Ÿå°±æ˜¯å…ˆäº Child æ»‘åŠ¨ã€‚</p>
<p>Child æ»‘åŠ¨ä»¥åï¼Œä¼šè°ƒç”¨ onNestedScroll()ï¼Œå›è°ƒåˆ° Parent çš„ onNestedScroll()ï¼Œè¿™é‡Œå°±æ˜¯ Child æ»‘åŠ¨åï¼Œå‰©ä¸‹çš„ç»™ Parent å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ åäº Child æ»‘åŠ¨ã€‚</p>
<p>æœ€åï¼Œæ»‘åŠ¨ç»“æŸï¼Œè°ƒç”¨ onStopNestedScroll() è¡¨ç¤ºæœ¬æ¬¡å¤„ç†ç»“æŸã€‚<br><br>è¿™ä¸ªæ–¹æ¡ˆå…¶å®å¾ˆä¸é”™ï¼Œä½†æœ€åè¢« pass äº†ï¼Œå› ä¸ºç”±äºå·¥ç¨‹çš„åŸå› ï¼Œæˆ‘ä»¬çš„ webview æ˜¯è¢«åŒ…è£¹èµ·æ¥çš„ï¼Œä¸å¯ä»¥ä»»æ„å»ç»§æ‰¿ NestedScrollingChild å¹¶åšå®šåˆ¶ä¿®æ”¹ã€‚</p>
<h3 id="2-è‡ªå®šä¹‰-ViewGroup"><a href="#2-è‡ªå®šä¹‰-ViewGroup" class="headerlink" title="2.è‡ªå®šä¹‰ ViewGroup"></a>2.è‡ªå®šä¹‰ ViewGroup</h3><p>å…¶å®ç›®å‰çš„é—®é¢˜æ˜¯å½“å­ View scroll åˆ°é¡¶éƒ¨æˆ–è€…åº•éƒ¨çš„æ—¶å€™ï¼Œæ— æ³•å°† Touch äº‹ä»¶æµäº¤è¿˜ç»™çˆ¶å¸ƒå±€ã€‚<br>å› æ­¤è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ€è·¯æ˜¯é€šè¿‡æˆ‘çš„ ViewGroup å»ç»Ÿä¸€ dispatchTouchEvent ç»™æˆ‘çš„å­ Viewï¼Œæ¡ä»¶å°±æ˜¯ï¼Œå‡å¦‚å­ View å¯ä»¥æ»šåŠ¨ï¼Œæˆ‘å°±ä¼šæ„é€ ä¸€å¥—å®Œæ•´çš„ touch æ—¶é—´æµåˆ†å‘ç»™ä»–ã€‚å¦åˆ™æˆ‘ä¼šè‡ªå·±æ¶ˆåŒ–ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="step-1"><a href="#step-1" class="headerlink" title="step 1:"></a>step 1:</h3><p>é€šè¿‡ç¬¬äºŒç§æ–¹å¼çš„æ€è·¯ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥éœ€è¦åœ¨æˆ‘çš„ ViewGroup æ‹¦æˆªæ‰€æœ‰çš„ Touch äº‹ä»¶ã€‚æ‰€ä»¥â€¦<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (isParentDispatchTouchEvent) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸Šæ¥æˆ‘ä»¬å°±æ‹¦æˆªå‡ºæ‰€æœ‰çš„ Touch äº‹ä»¶ã€‚</p>
<h3 id="step2"><a href="#step2" class="headerlink" title="step2:"></a>step2:</h3><p>å¼€å§‹åœ¨ ViewGroup çš„ onTouchEvent å¤„ç†æ‰€æœ‰ç›¸å…³çš„ Eventã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.åˆå§‹è®°å½• Touch åæ ‡</span></div><div class="line"><span class="keyword">int</span> mDownY = event.getY();</div><div class="line"><span class="keyword">int</span> deltaY = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment">// 2.é»˜è®¤å­ View æŒæœ‰äº‹ä»¶æµèµ·å§‹ç‚¹ isHoldTouch = true,é€šè¿‡ isChildCanScroll æ¥åˆ¤åˆ«å½“å‰å­ View æ˜¯å¦å¯ä»¥æ»šåŠ¨ã€‚</span></div><div class="line"><span class="keyword">if</span> (isHoldTouch &amp;&amp; !isChildCanScroll(event, deltaY) &amp;&amp; deltaY != <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// 3.å‡å¦‚å­ View ä¸å¯ä»¥æ»šåŠ¨ï¼Œå½“å‰ ViewGroup éœ€è¦é˜»æ–­ Touch çš„ä¸‹å‘ï¼Œä¸ºäº†éµå¾ª Touch äº‹ä»¶æµçš„è§„èŒƒï¼Œå½“è¢«å¤–éƒ¨é˜»æ–­æ—¶ï¼Œéœ€è¦å¯¹å…¶ä¸‹å‘ ACTION_CANELã€‚åŒæ—¶ isHoldTouch = falseã€‚</span></div><div class="line">    isHoldTouch = <span class="keyword">false</span>;</div><div class="line">    MotionEvent cancelEvent = MotionEvent.obtain(event);</div><div class="line">    cancelEvent.setAction(MotionEvent.ACTION_CANCEL);</div><div class="line">    getChildAt(<span class="number">0</span>).dispatchTouchEvent(cancelEvent);</div><div class="line">    cancelEvent.recycle();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 5.å‡å¦‚å½“æˆ‘ä»¬åœ¨ ViewGroup æ»šåŠ¨è¿‡ç¨‹ä¸­ï¼Œæ»‘åŠ¨åˆ°äº†å­ View å¯æ»šåŠ¨çš„çŠ¶æ€ï¼Œè¿™æ—¶å€™ä¼šå°† ViewGroup è°ƒæ•´è‡³æ»šåŠ¨åˆå§‹ä½ç½®ï¼Œç„¶åå¯¹å­ View åšä¸€ä¸ª ACTION_DOWN çš„æ“ä½œï¼Œä»è€Œå¼€å§‹é™†ç»­åˆ†å‘å­ View Touch äº‹ä»¶ã€‚åŒæ—¶ isHoldTouch = trueã€‚</span></div><div class="line"><span class="keyword">if</span> (!isHoldTouch &amp;&amp; isChildCanScroll(event, deltaY) &amp;&amp; deltaY != <span class="number">0</span>) &#123;</div><div class="line">    setSheetTranslation(maxSheetTranslation);</div><div class="line">    isHoldTouch = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span> (event.getAction() == MotionEvent.ACTION_MOVE) &#123;</div><div class="line">        MotionEvent downEvent = MotionEvent.obtain(event);</div><div class="line">        downEvent.setAction(MotionEvent.ACTION_DOWN);</div><div class="line">        getChildAt(<span class="number">0</span>).dispatchTouchEvent(downEvent);</div><div class="line">        downEvent.recycle();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (isHoldTouch &amp;&amp; deltaY != <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// 6.å½“å‰åˆ¤æ–­å­ View å·²ç»å¤„äºå¯åˆ†å‘ Touch çŠ¶æ€ï¼Œä¼šé™†ç»­å°† ACTION_MOVE åˆ†å‘ç»™ä»–ã€‚ä»è€Œå®ç°å­ View çš„æ»šåŠ¨ã€‚</span></div><div class="line">    event.offsetLocation(<span class="number">0</span>, mSheetTranslation - mTouchParentViewOriginMeasureHeight);</div><div class="line">    getChildAt(<span class="number">0</span>).dispatchTouchEvent(event);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// 4.å½“ä¸Šé¢é˜»æ–­å®Œ Touch çš„ä¸‹å‘ä»¥åï¼Œè¿™é‡Œæˆ‘ä»¬å¼€å§‹è‡ªå·±æ¶ˆåŒ– Touch äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œä¼šåšä¸€ä¸ª TranslationY ä¿®æ”¹ï¼Œä»è€Œè¾¾åˆ° ViewGroup åš Yè½´æ–¹å‘çš„åç§».</span></div><div class="line">    setSheetTranslation(newSheetTranslation);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (event.getAction() == MotionEvent.ACTION_UP || event.getAction() == MotionEvent.ACTION_CANCEL) &#123;</div><div class="line">        <span class="comment">// 7.ä¸ºäº†å°†è¿™ä¸ªç»“æŸäº‹ä»¶åé¢åˆ†å‘ç»™å­ View</span></div><div class="line">        isHoldTouch = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="step3"><a href="#step3" class="headerlink" title="step3:"></a>step3:</h3><p>åˆ¤æ–­å­ View æ˜¯å¦å¯ä»¥æ»šåŠ¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/**</span></div><div class="line">    * child can scroll</div><div class="line">    * <span class="doctag">@param</span> view</div><div class="line">    * <span class="doctag">@param</span> x</div><div class="line">    * <span class="doctag">@param</span> y</div><div class="line">    * <span class="doctag">@param</span> lockRect æ˜¯å¦å¼€å¯ å…è®¸ touch è„±ç¦»å½“å‰å­ View åŒºåŸŸç»§ç»­ç”Ÿæ•ˆã€‚</div><div class="line">    * <span class="doctag">@return</span></div><div class="line">    */</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">canScrollUp</span><span class="params">(View view, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">boolean</span> lockRect)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> WebView) &#123;</div><div class="line">        <span class="keyword">return</span> canWebViewScrollUp();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;</div><div class="line">        ViewGroup vg = (ViewGroup) view;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vg.getChildCount(); i++) &#123;</div><div class="line">            View child = vg.getChildAt(i);</div><div class="line">            <span class="keyword">int</span> childLeft = child.getLeft() - view.getScrollX();</div><div class="line">            <span class="keyword">int</span> childTop = child.getTop() - view.getScrollY();</div><div class="line">            <span class="keyword">int</span> childRight = child.getRight() - view.getScrollX();</div><div class="line">            <span class="keyword">int</span> childBottom = child.getBottom() - view.getScrollY();</div><div class="line">            <span class="keyword">boolean</span> intersects = x &gt; childLeft &amp;&amp; x &lt; childRight &amp;&amp; y &gt; childTop &amp;&amp; y &lt; childBottom;</div><div class="line">            <span class="keyword">if</span> ((!lockRect || intersects)</div><div class="line">                    &amp;&amp; canScrollUp(child, x - childLeft, y - childTop, lockRect)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> CoordinatorLayout &amp;&amp;</div><div class="line">            ((CoordinatorLayout) view).getChildCount() &gt; <span class="number">0</span> &amp;&amp;</div><div class="line">            ((CoordinatorLayout) view).getChildAt(<span class="number">0</span>) <span class="keyword">instanceof</span> AppBarLayout) &#123;</div><div class="line">        AppBarLayout layout = (AppBarLayout) ((CoordinatorLayout) view).getChildAt(<span class="number">0</span>);</div><div class="line">        OnNestOffsetChangedListener listener = mOnOffsetChangedListener.get(layout.hashCode());</div><div class="line">        <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (listener.getOffsetY() &lt; layout.getMeasuredHeight() &amp;&amp; listener.getOffsetY() &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> view.canScrollVertically(-<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * child can scroll</div><div class="line">    * <span class="doctag">@param</span> view</div><div class="line">    * <span class="doctag">@param</span> x</div><div class="line">    * <span class="doctag">@param</span> y</div><div class="line">    * <span class="doctag">@param</span> lockRect æ˜¯å¦å¼€å¯ å…è®¸ touch è„±ç¦»å½“å‰å­ View åŒºåŸŸç»§ç»­ç”Ÿæ•ˆã€‚</div><div class="line">    * <span class="doctag">@return</span></div><div class="line">    */</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">canScrollDown</span><span class="params">(View view, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">boolean</span> lockRect)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> WebView) &#123;</div><div class="line">        <span class="keyword">return</span> canWebViewScrollDown();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;</div><div class="line">        ViewGroup vg = (ViewGroup) view;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vg.getChildCount(); i++) &#123;</div><div class="line">            View child = vg.getChildAt(i);</div><div class="line">            <span class="keyword">int</span> childLeft = child.getLeft() - view.getScrollX();</div><div class="line">            <span class="keyword">int</span> childTop = child.getTop() - view.getScrollY();</div><div class="line">            <span class="keyword">int</span> childRight = child.getRight() - view.getScrollX();</div><div class="line">            <span class="keyword">int</span> childBottom = child.getBottom() - view.getScrollY();</div><div class="line">            <span class="keyword">boolean</span> intersects = x &gt; childLeft &amp;&amp; x &lt; childRight &amp;&amp; y &gt; childTop &amp;&amp; y &lt; childBottom;</div><div class="line">            <span class="keyword">if</span> ((!lockRect || intersects)</div><div class="line">                    &amp;&amp; canScrollDown(child, x - childLeft, y - childTop, lockRect)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> CoordinatorLayout &amp;&amp;</div><div class="line">            ((CoordinatorLayout) view).getChildCount() &gt; <span class="number">0</span> &amp;&amp;</div><div class="line">            ((CoordinatorLayout) view).getChildAt(<span class="number">0</span>) <span class="keyword">instanceof</span> AppBarLayout) &#123;</div><div class="line">        AppBarLayout layout = (AppBarLayout) ((CoordinatorLayout) view).getChildAt(<span class="number">0</span>);</div><div class="line">        OnNestOffsetChangedListener listener = mOnOffsetChangedListener.get(layout.hashCode());</div><div class="line">        <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (listener.getOffsetY() &lt; layout.getMeasuredHeight() &amp;&amp; listener.getOffsetY() &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> view.canScrollVertically(<span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™éƒ¨åˆ†æ ¸å¿ƒåœ¨äºé€’å½’æŸ¥è¯¢å½“å‰ MotionEvent å½“å‰åæ ‡ä¸‹çš„æ‰€æœ‰å­ View æœ‰æ²¡æœ‰å¯ä»¥æ»šåŠ¨çš„ Viewï¼Œä»è€Œæ ¹æ® view.canScrollVertically æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p>
<h2 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h2><p>1.æ”¯æŒç»å¤§å¤šæ•°çš„ View åµŒå¥—æ»šåŠ¨ã€‚<br>2.æˆæœ¬ä½ï¼Œåªéœ€è¦åœ¨ä½ æƒ³è¦åµŒå¥—æ»šåŠ¨çš„ View ä¸Šé¢åŒ…ä¸€å±‚è¿™ä¸ª Layoutã€‚</p>
<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>1.æ”¯æŒåµŒå¥—æ»šåŠ¨ï¼Œæ— ç¼æ‹–æ‹½<br>2.æ”¯æŒ BottomSheet (ä½¿ç”¨æ–¹æ³•è¯¦è§ä¸‹æ–¹)<br>3.æ”¯æŒ Appbarlayout<br>3.æ”¯æŒæ‹–æ‹½é˜»å°¼ (ä½¿ç”¨æ–¹æ³•è¯¦è§ä¸‹æ–¹)</p>
<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><table>
<thead>
<tr>
<th><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo1.gif?raw=true" alt="demo1"></th>
<th style="text-align:center"><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo2.gif?raw=true" alt="demo2"></th>
</tr>
</thead>
<tbody>
<tr>
<td>normal</td>
<td style="text-align:center">webview</td>
</tr>
<tr>
<td><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo3.gif?raw=true" alt="demo3"></td>
<td style="text-align:center"><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo4.gif?raw=true" alt="demo4"></td>
</tr>
<tr>
<td>bottomsheet normal</td>
<td style="text-align:center">bottomsheet appbarlayout</td>
</tr>
<tr>
<td><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo8.gif?raw=true" alt="demo8"></td>
<td style="text-align:center"><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo9.gif?raw=true" alt="demo9"></td>
</tr>
<tr>
<td>view recyclerview</td>
<td style="text-align:center">webview recyclerview</td>
</tr>
<tr>
<td><img src="https://github.com/JarvisGG/NestedTouchScrollingLayout/blob/master/captures/demo6.gif?raw=true" alt="demo6"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>question</td>
</tr>
</tbody>
</table>
<h3 id="Usage-example"><a href="#Usage-example" class="headerlink" title="Usage example"></a>Usage example</h3><h4 id="normal-use"><a href="#normal-use" class="headerlink" title="normal use"></a>normal use</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">jarvis.com.library.NestedTouchScrollingLayout</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/wrapper"</span></div><div class="line">    <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/container_rv"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"400dp"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"#fff"</span></div><div class="line">        <span class="attr">android:overScrollMode</span>=<span class="string">"always"</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.RecyclerView</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">jarvis.com.library.NestedTouchScrollingLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è®¾ç½®æ‰‹æŒ‡ä¸‹æ‹‰é˜»å°¼</span></div><div class="line">mNestedTouchScrollingLayout.setDampingDown(<span class="number">2.0f</span> / <span class="number">5</span>);</div><div class="line"><span class="comment">// è®¾ç½®æ‰‹æŒ‡ä¸Šæ‹‰é˜»å°¼</span></div><div class="line">mNestedTouchScrollingLayout.setDampingUp(<span class="number">3.0f</span> / <span class="number">5</span>);</div><div class="line"></div><div class="line">mNestedTouchScrollingLayout.registerNestScrollChildCallback(<span class="keyword">new</span> NestedTouchScrollingLayout.INestChildScrollChange() &#123;</div><div class="line">        </div><div class="line">        <span class="comment">// å½“å‰ Layout åç§»è·ç¦»</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestChildScrollChange</span><span class="params">(<span class="keyword">float</span> deltaY, <span class="keyword">float</span> velocityY)</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// finger è„±ç¦»å±å¹• Layout åç§»é‡ï¼Œä»¥åŠå½“å‰ Layout çš„é€Ÿåº¦</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestChildScrollRelease</span><span class="params">(<span class="keyword">final</span> <span class="keyword">float</span> deltaY, <span class="keyword">final</span> <span class="keyword">int</span> velocityY)</span> </span>&#123;</div><div class="line">		mNestedTouchScrollingLayout.recover(<span class="number">0</span>, <span class="keyword">new</span> Runnable() &#123;</div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">				Log.i(<span class="string">"NestedTouchScrollingLayout ---&gt; "</span>, <span class="string">"deltaY : "</span> + deltaY + <span class="string">" velocityY : "</span> + velocityY);</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// æ‰‹æŒ‡æŠ¬èµ·æ—¶æœº</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFingerUp</span><span class="params">(<span class="keyword">float</span> velocityY)</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// æ¨ªå‘æ‹–æ‹½</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestChildHorizationScroll</span><span class="params">(MotionEvent event, <span class="keyword">float</span> deltaX, <span class="keyword">float</span> deltaY)</span> </span>&#123;</div><div class="line">	</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="bottomsheet-use"><a href="#bottomsheet-use" class="headerlink" title="bottomsheet use"></a>bottomsheet use</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="tag">&lt;<span class="name">jarvis.com.library.NestedTouchScrollingLayout</span></span></div><div class="line">	<span class="attr">android:id</span>=<span class="string">"@+id/wrapper"</span></div><div class="line">	<span class="attr">android:layout_marginTop</span>=<span class="string">"30dp"</span></div><div class="line">	<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">	<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">		<span class="attr">android:background</span>=<span class="string">"#fff"</span></div><div class="line">		<span class="attr">android:id</span>=<span class="string">"@+id/container_rv"</span></div><div class="line">		<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">		<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">jarvis.com.library.NestedTouchScrollingLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä¸´ç•Œé€Ÿåº¦ï¼Œæ ¹æ®ä¸šåŠ¡è€Œå®š</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> mVelocityYBound = <span class="number">1300</span>;</div><div class="line"></div><div class="line"><span class="comment">// è§„å®š sheetView å¼¹èµ·æ–¹å‘</span></div><div class="line">mNestedTouchScrollingLayout.setSheetDirection(NestedTouchScrollingLayout.SheetDirection.BOTTOM);</div><div class="line"></div><div class="line">mNestedTouchScrollingLayout.registerNestScrollChildCallback(<span class="keyword">new</span> NestedTouchScrollingLayout.INestChildScrollChange() &#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestChildScrollChange</span><span class="params">(<span class="keyword">float</span> deltaY)</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestChildScrollRelease</span><span class="params">(<span class="keyword">final</span> <span class="keyword">float</span> deltaY, <span class="keyword">final</span> <span class="keyword">int</span> velocityY)</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> totalYRange = mNestedTouchScrollingLayout.getMeasuredHeight();</div><div class="line">		<span class="keyword">int</span> helfLimit = (totalYRange - DisplayUtils.dpToPixel(BottomSheetActivity.<span class="keyword">this</span>, <span class="number">400</span>)) / <span class="number">2</span>;</div><div class="line">		<span class="keyword">int</span> hideLimit = totalYRange - DisplayUtils.dpToPixel(BottomSheetActivity.<span class="keyword">this</span>, <span class="number">400</span>) / <span class="number">2</span>;</div><div class="line">		<span class="keyword">int</span> helfHeight = totalYRange - DisplayUtils.dpToPixel(BottomSheetActivity.<span class="keyword">this</span>, <span class="number">400</span>);</div><div class="line">		<span class="keyword">if</span> (velocityY &gt; mVelocityYBound &amp;&amp; velocityY &gt; <span class="number">0</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (Math.abs(deltaY) &gt; helfHeight) &#123;</div><div class="line">				mNestedTouchScrollingLayout.hiden();</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				mNestedTouchScrollingLayout.peek(mNestedTouchScrollingLayout.getMeasuredHeight() - DisplayUtils.dpToPixel(BottomSheetActivity.<span class="keyword">this</span>,<span class="number">400</span>));</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (velocityY &lt; -mVelocityYBound &amp;&amp; velocityY &lt; <span class="number">0</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (Math.abs(deltaY) &lt; helfHeight) &#123;</div><div class="line">				mNestedTouchScrollingLayout.expand();</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				mNestedTouchScrollingLayout.peek(mNestedTouchScrollingLayout.getMeasuredHeight() - DisplayUtils.dpToPixel(BottomSheetActivity.<span class="keyword">this</span>,<span class="number">400</span>));</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (Math.abs(deltaY) &gt; hideLimit) &#123;</div><div class="line">				mNestedTouchScrollingLayout.hiden();</div><div class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Math.abs(deltaY) &gt; helfLimit) &#123;</div><div class="line">				mNestedTouchScrollingLayout.peek(mNestedTouchScrollingLayout.getMeasuredHeight() - DisplayUtils.dpToPixel(BottomSheetActivity.<span class="keyword">this</span>, <span class="number">400</span>));</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				mNestedTouchScrollingLayout.expand();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFingerUp</span><span class="params">(<span class="keyword">float</span> velocityY)</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestChildHorizationScroll</span><span class="params">(MotionEvent event, <span class="keyword">float</span> deltaX, <span class="keyword">float</span> deltaY)</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>æ–¹å¼ 1:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    maven &#123; url <span class="string">"https://jitpack.io"</span> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    implementation <span class="string">'com.github.JarvisGG:NestedTouchScrollingLayout:1.2.3'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ–¹å¼ 2:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    jcenter()</div><div class="line">&#125;</div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    implementation <span class="string">'com.jarvis.library.NestedTouchScrollingLayout:library:1.2.3'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p><a href="https://github.com/JarvisGG/NestedTouchScrollingLayout" target="_blank" rel="external">https://github.com/JarvisGG/NestedTouchScrollingLayout</a></p>
<h3 id="æ¬¢è¿å¤§å®¶é£Ÿç”¨"><a href="#æ¬¢è¿å¤§å®¶é£Ÿç”¨" class="headerlink" title="æ¬¢è¿å¤§å®¶é£Ÿç”¨"></a>æ¬¢è¿å¤§å®¶é£Ÿç”¨</h3>]]></content>
      
        
        <tags>
            
            <tag> Android å¼€æºæ§ä»¶ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ObjectAdapter æ‰©å±•RecyclerView Adapterçš„æ–¹å¼]]></title>
      <url>/2017/11/01/ObjectAdapter%20%E6%89%A9%E5%B1%95RecyclerView%20Adapter%E7%9A%84%E6%96%B9%E5%BC%8F/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>èµ·å› ï¼Œéšç€ä¸šåŠ¡çš„å¼€å±•ï¼Œæˆ‘ä»¬çš„Feedåˆ—è¡¨æœ‰æ—¶ä¼šå¢åŠ å¥½å¤šçš„å¡ç‰‡ç±»å‹ï¼Œè€Œè¿‡å¤šçš„å¡ç‰‡å°±ä¼šå¼•å‘è¿‡å¤šçš„ ViewHolderï¼ŒViewType é€ æˆAdapterè·¯åŸºå†—æ‚ã€‚é‚£ä¹ˆæœ¬ç¯‡åšå®¢å°±æ˜¯åŸºäºè¿™ä¸ªé—®é¢˜åšçš„Adapter æ‰©å±•ã€‚<br><a id="more"></a></p>
<h2 id="æ‰©å±•å¯¹æ¯”"><a href="#æ‰©å±•å¯¹æ¯”" class="headerlink" title="æ‰©å±•å¯¹æ¯”"></a>æ‰©å±•å¯¹æ¯”</h2><h3 id="æ‰©å±•å‰"><a href="#æ‰©å±•å‰" class="headerlink" title="æ‰©å±•å‰"></a>æ‰©å±•å‰</h3><p>Activity:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">recyclerView.setAdapter(<span class="keyword">new</span> OldAdapter(<span class="keyword">this</span>));</div><div class="line">recyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</div></pre></td></tr></table></figure></p>
<p>Adapter:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OldAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="keyword">private</span> LayoutInflater mInflater;</div><div class="line">    <span class="keyword">private</span> List&lt;IndexTypeEnum&gt; mData;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OldAdapter</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mContext = context;</div><div class="line">        <span class="keyword">this</span>.mInflater = LayoutInflater.from(mContext);</div><div class="line">        <span class="keyword">this</span>.mData = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> RecyclerView.<span class="function">ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        View view;</div><div class="line">        <span class="keyword">if</span> (viewType == <span class="number">1</span>) &#123;</div><div class="line">            view = mInflater.inflate(R.layout.item_frist, parent, <span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewType == <span class="number">2</span>) &#123;</div><div class="line">            view = mInflater.inflate(R.layout.item_second, parent, <span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            view = mInflater.inflate(R.layout.item_thrid, parent, <span class="keyword">false</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InnerViewHolder(view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="comment">// ...do</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (position == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(List&lt;IndexTypeEnum&gt; data)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mData = data;</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(IndexTypeEnum indexTypeEnum, <span class="keyword">int</span> pos)</span> </span>&#123;</div><div class="line">        mData.add(pos, indexTypeEnum);</div><div class="line">        notifyItemChanged(pos);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(IndexTypeEnum indexTypeEnum, <span class="keyword">int</span> pos)</span> </span>&#123;</div><div class="line">        mData.remove(pos);</div><div class="line">        notifyItemChanged(pos);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span> </span>&#123;</div><div class="line">        IndexTypeEnum indexTypeEnum = mData.get(fromPosition);</div><div class="line">        mData.set(fromPosition, mData.get(toPosition));</div><div class="line">        mData.set(toPosition, indexTypeEnum);</div><div class="line">        notifyItemMoved(fromPosition, toPosition);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InnerViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ·»åŠ ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adapter.add(<span class="number">1</span>, FRIST);</div></pre></td></tr></table></figure></p>
<p>åˆ é™¤ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adapter.remove(<span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>ç§»åŠ¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adapter.move(<span class="number">1</span>,<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h3 id="æ‰©å±•å"><a href="#æ‰©å±•å" class="headerlink" title="æ‰©å±•å"></a>æ‰©å±•å</h3><p>Activity:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">presenterSelector = <span class="keyword">new</span> ZhihuPresenterSelector(<span class="keyword">this</span>);</div><div class="line">objectAdapter = <span class="keyword">new</span> ArrayObjectAdapter(presenterSelector);</div><div class="line">recyclerView.setObjectAdapter(objectAdapter);</div><div class="line">recyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</div><div class="line"></div><div class="line"><span class="keyword">for</span> (IndexTypeEnum indexTypeEnum : data) &#123;</div><div class="line">    objectAdapter.add(indexTypeEnum);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>PresenterSelector:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhihuPresenterSelector</span> <span class="keyword">extends</span> <span class="title">PresenterSelector</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;Presenter&gt; mPresenters = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> FristPresenter fristPresenter;</div><div class="line">    <span class="keyword">private</span> SecondPresenter secondPresenter;</div><div class="line">    <span class="keyword">private</span> ThridPresenter thridPresenter;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ZhihuPresenterSelector</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        fristPresenter = <span class="keyword">new</span> FristPresenter(context);</div><div class="line">        secondPresenter = <span class="keyword">new</span> SecondPresenter(context);</div><div class="line">        thridPresenter = <span class="keyword">new</span> ThridPresenter(context);</div><div class="line">        containerPresenter = <span class="keyword">new</span> ContainerPresenter(context);</div><div class="line"></div><div class="line">        mPresenters.add(fristPresenter);</div><div class="line">        mPresenters.add(secondPresenter);</div><div class="line">        mPresenters.add(thridPresenter);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Presenter <span class="title">getPresenter</span><span class="params">(Object item)</span> </span>&#123;</div><div class="line">        IndexTypeEnum indexRow = (IndexTypeEnum) item;</div><div class="line">        <span class="keyword">switch</span> (indexRow) &#123;</div><div class="line">            <span class="keyword">case</span> FRIST:</div><div class="line">                <span class="keyword">return</span> fristPresenter;</div><div class="line">            <span class="keyword">case</span> SECOND:</div><div class="line">                <span class="keyword">return</span> secondPresenter;</div><div class="line">            <span class="keyword">case</span> THRIED:</div><div class="line">                <span class="keyword">return</span> thridPresenter;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">return</span> fristPresenter;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> Presenter[] getPresenters() &#123;</div><div class="line">        <span class="keyword">return</span> mPresenters.toArray(<span class="keyword">new</span> Presenter[mPresenters.size()]);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Presenter:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FristPresenter</span> <span class="keyword">extends</span> <span class="title">Presenter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="keyword">private</span> LayoutInflater mInflater;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FristPresenter</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mContext = context;</div><div class="line">        <span class="keyword">this</span>.mInflater = ((Activity) context).getLayoutInflater();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent)</span> </span>&#123;</div><div class="line">        View view = mInflater.inflate(R.layout.item_frist, parent, <span class="keyword">false</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InnerViewHolder(view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder viewHolder, Object item, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUnBindViewHolder</span><span class="params">(ViewHolder viewHolder)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerViewHolder</span> <span class="keyword">extends</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InnerViewHolder</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(view);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ·»åŠ ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">objectAdapter.add(<span class="number">1</span>, indexTypeEnum)</div></pre></td></tr></table></figure></p>
<p>åˆ é™¤ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">objectAdapter.remove(indexTypeEnum1);</div><div class="line">objectAdapter.remove(<span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>ç§»åŠ¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">objectAdapter.move(<span class="number">1</span>,<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h3 id="å°èŠ‚"><a href="#å°èŠ‚" class="headerlink" title="å°èŠ‚"></a>å°èŠ‚</h3><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¼˜åŒ–å‰Adapteræ˜¯å¾ˆå†—æ‚çš„ï¼Œä½†ä¼˜åŒ–åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰èŒè´£è¯¦ç»†åˆ’åˆ†è¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘.<br><br>1.æˆ‘ä»¬è¿™é‡Œé€šè¿‡ PresenterSelector æ¥æ€»ç»“å½“å‰æ‰€æœ‰çš„å¡ç‰‡ç§ç±»ï¼ˆPresenter).<br><br>2.å°†æˆ‘ä»¬ä¸åŒçš„å¡ç‰‡ä¸šåŠ¡é€»è¾‘åˆ’åˆ†åˆ°å¯¹åº”çš„ Presenter.<br><br>3.å…³äºåŸºæœ¬æ“ä½œå…¨éƒ¨å°è£…åœ¨ ObjectAdapter.<br></p>
<h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use?"></a>How to use?</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    maven &#123; url <span class="string">"https://jitpack.io"</span> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.jarvis.library:ObjectAdapter:1.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
        
        <tags>
            
            <tag> Android å¼€æºæ§ä»¶ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android TV ç„¦ç‚¹æ¢ç´¢]]></title>
      <url>/2017/07/20/Android%20TV%20%E7%84%A6%E7%82%B9%E4%B8%A2%E5%A4%B1%E7%9A%84%E7%BD%AA%E9%AD%81%E7%A5%B8%E9%A6%96/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¯•ä¸šä»äº‹Android TV å¼€å‘ä¸€å¹´äº†ï¼Œè¿™ä¸€å¹´è¦ç»•ç€æˆ‘ï¼ŒæŒ¥ä¹‹ä¸å»çš„å°±æ˜¯ç„¦ç‚¹é€»è¾‘ï¼ŒTV åŒºåˆ«äºæ‰‹æœºçš„UIäº¤äº’åŒºåˆ«ï¼Œåº”è¯¥å°±æ˜¯focusäº‹ä»¶ä¸touchäº‹ä»¶äº†ï¼Œè€Œå›½å†…å…³äºAndroid TVçš„ç›˜å­è¿˜ä¸å¦‚æ‰‹æœºç«¯è¸©å¾—å¤šï¼Œé‚£ä¹ˆä»Šå¤©æ‰“ç®—æ€»ç»“ä¸€ä¸‹ç„¦ç‚¹çš„å‡ ä¸ªç–‘æƒ‘ã€‚è¿™é‡Œæˆ‘ä¼šåˆ†ç„¦ç‚¹æœç´¢ï¼Œç„¦ç‚¹ä¸¢å¤±æ¥è°ˆè°ˆã€‚è¸©è¸©ç›˜å­ã€‚<br><a id="more"></a></p>
<h2 id="ç„¦ç‚¹æœç´¢"><a href="#ç„¦ç‚¹æœç´¢" class="headerlink" title="ç„¦ç‚¹æœç´¢"></a>ç„¦ç‚¹æœç´¢</h2><p>è¿™å—å„¿Androidæºç å¾ˆæœ‰æ„æ€ï¼Œè°·æ­Œçˆ¹ä»¬çœŸçš„ç‰›å•Šï¼Œå¥½äº†ï¼Œå½“æˆ‘ä»¬ç”¨é¥æ§å™¨æŒ‰ä¸Šä¸‹å·¦å³é”®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨focusSearchï¼Œæˆ‘ä»¬ç»“åˆæºç çœ‹ä¸€ä¸‹.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">focusSearch</span><span class="params">(@FocusRealDirection <span class="keyword">int</span> direction)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mParent != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> mParent.focusSearch(<span class="keyword">this</span>, direction);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>focus å½“å‰è·å¾—ç„¦ç‚¹çš„Viewï¼Œdirectionå½“å‰æŒ‰é”®äº‹ä»¶æ–¹å‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡ŒViewä¼šå°†ç„¦ç‚¹ä¸ŠæŠ›ç»™Parentï¼Œæ¥ä¸ªæˆ‘ä»¬è¿›å»çœ‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">focusSearch</span><span class="params">(View focused, <span class="keyword">int</span> direction)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (isRootNamespace()) &#123;</div><div class="line">        <span class="comment">// root namespace means we should consider ourselves the top of the</span></div><div class="line">        <span class="comment">// tree for focus searching; otherwise we could be focus searching</span></div><div class="line">        <span class="comment">// into other tabs.  see LocalActivityManager and TabHost for more info</span></div><div class="line">        <span class="keyword">return</span> FocusFinder.getInstance().findNextFocus(<span class="keyword">this</span>, focused, direction);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mParent != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> mParent.focusSearch(focused, direction);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ªæ˜¯å¦æ˜¯æ ¹ç©ºé—´çš„åˆ¤æ–­ï¼Œå€˜è‹¥å½“å‰</p>
]]></content>
      
        
        <tags>
            
            <tag> Android æºç  </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RxBus çš„åˆæ­¥æ¢ç´¢]]></title>
      <url>/2017/06/20/RxBus%20%E7%9A%84%E5%88%9D%E6%AD%A5%E6%8E%A2%E7%B4%A2/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>5æœˆä»½é¡¹ç›®ä¸Šçº¿äº†ï¼Œä¹‹åå°±åœ¨ä¼˜åŒ–é¡¹ç›®ç»“æ„ï¼Œå‡å°‘ä¾èµ–ã€‚ä¹‹å‰é¡¹ç›®ä¸€ç›´ç”¨çš„EventBusæ¥ä½œä¸ºé¡¹ç›®äº‹ä»¶æµçš„æ¡†æ¶ï¼Œè¿™ä¸¤å¤©å¶ç„¶çœ‹åˆ°RxBusè¿™ä¸ªä¸œè¥¿ï¼ŒåŸºäºRxJavaå’ŒRxAndroidï¼Œè€ƒè™‘åˆ°è‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œç”±äºæœ¬èº«ç”¨EventBusçš„åŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œè€Œå‘ç°RxBusè¶³ä»¥å®ç°æˆ‘ç°æœ‰çš„ä¸šåŠ¡ï¼Œæ‰€ä»¥å†³å®šè¸©è¸©å‘ã€‚<br><a id="more"></a></p>
<h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxBus</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RxBus mInstance;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Subject mBus;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RxBus</span><span class="params">()</span> </span>&#123;</div><div class="line">        mBus = <span class="keyword">new</span> SerializedSubject&lt;&gt;(PublishSubject.create());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RxBus <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mInstance == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">synchronized</span> (RxBus.class) &#123;</div><div class="line">                <span class="keyword">if</span> (mInstance == <span class="keyword">null</span>) &#123;</div><div class="line">                    mInstance = <span class="keyword">new</span> RxBus();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> mInstance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object object)</span> </span>&#123;</div><div class="line">        mBus.onNext(object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">toObserverable</span><span class="params">(Class&lt;T&gt; eventType)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mBus.ofType(eventType);</div><div class="line"><span class="comment">//        return mBus.filter(eventType::isInstance)</span></div><div class="line"><span class="comment">//                .cast(eventType);</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›®å‰åªæ˜¯æ¶ˆæ¯çš„æ³¨å†Œï¼Œå‘é€ã€‚</p>
<h4 id="SerializedSubject"><a href="#SerializedSubject" class="headerlink" title="SerializedSubject"></a>SerializedSubject</h4><p>SerializedSubject ç‰¹å¾æ˜¯çº¿ç¨‹å®‰å…¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SerializedSubject</span><span class="params">(<span class="keyword">final</span> Subject&lt;T, R&gt; actual)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(<span class="keyword">new</span> OnSubscribe&lt;R&gt;() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> R&gt; child)</span> </span>&#123;</div><div class="line">            actual.unsafeSubscribe(child);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">this</span>.actual = actual;</div><div class="line">    <span class="keyword">this</span>.observer = <span class="keyword">new</span> SerializedObserver&lt;T&gt;(actual);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼Œactual æ˜¯å½“å‰çš„æ•°æ®é“¾ï¼Œè¿™é‡Œé€šè¿‡SerializedObserverå°†æ•°æ®é“¾åšä¸€ä¸ªè½¬æ¢ï¼Œç±»ä¼¼äºmapã€‚<br>ä¸‹é¢æˆ‘ä»¬çœ‹SerializedObserver<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (terminated) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (terminated) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (emitting) &#123;</div><div class="line">            FastList list = queue;</div><div class="line">            <span class="keyword">if</span> (list == <span class="keyword">null</span>) &#123;</div><div class="line">                list = <span class="keyword">new</span> FastList();</div><div class="line">                queue = list;</div><div class="line">            &#125;</div><div class="line">            list.add(NotificationLite.next(t));</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        emitting = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        actual.onNext(t);</div><div class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</div><div class="line">        terminated = <span class="keyword">true</span>;</div><div class="line">        Exceptions.throwOrReport(e, actual, t);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        FastList list;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            list = queue;</div><div class="line">            <span class="keyword">if</span> (list == <span class="keyword">null</span>) &#123;</div><div class="line">                emitting = <span class="keyword">false</span>;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            queue = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (Object o : list.array) &#123;</div><div class="line">            <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">if</span> (NotificationLite.accept(actual, o)) &#123;</div><div class="line">                    terminated = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</div><div class="line">                terminated = <span class="keyword">true</span>;</div><div class="line">                Exceptions.throwIfFatal(e);</div><div class="line">                actual.onError(OnErrorThrowable.addValueAsLastCause(e, t));</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œä¸‘æŠ½å‡ºonNextï¼Œæˆ‘ä»¬å‘ç°synchronizedçº¿ç¨‹é”ï¼Œè¯æ˜å½“å‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å¤šä¸ªçº¿ç¨‹å†è¦æ‰§è¡ŒonNextï¼Œè¿™é‡Œçº¿ç¨‹å®‰å…¨ï¼Œæ’é˜Ÿçº¿ç¨‹ä¼šåŠ å…¥queueï¼Œç„¶åä¾æ¬¡æ‰§è¡Œã€‚onErrorï¼ŒonCompleteåŒç†ã€‚</p>
<h4 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h4><p>ä¸æ™®é€šçš„Subjectä¸åŒï¼Œåœ¨è®¢é˜…æ—¶å¹¶ä¸ç«‹å³è§¦å‘è®¢é˜…äº‹ä»¶ï¼Œè€Œæ˜¯å…è®¸æˆ‘ä»¬åœ¨ä»»æ„æ—¶åˆ»æ‰‹åŠ¨è°ƒç”¨onNext(),onError(),onCompletedæ¥è§¦å‘äº‹ä»¶ã€‚<br>å¯ä»¥çœ‹åˆ°PublishSubjectä¸æ™®é€šçš„Subjectæœ€å¤§çš„ä¸åŒå°±æ˜¯å…¶å¯ä»¥å…ˆè®¢é˜…äº‹ä»¶ï¼Œç„¶ååœ¨æŸä¸€æ—¶åˆ»æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æ¥è§¦å‘äº‹ä»¶ã€‚<br>demoï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">PublishSubject&lt;String&gt; publishSubject = PublishSubject.create();</div><div class="line">publishSubject.subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">            <span class="comment">// TODO</span></div><div class="line">        &#125;</div><div class="line">&#125;);</div><div class="line">publishSubject.onNext(result);</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚å…ˆå¯¹Subjectè¿›è¡Œè®¢é˜…ï¼Œç„¶åå†é»˜ä¸€æ—¶åˆ»è§¦å‘æˆ‘ä»¬çš„onNextã€‚</p>
<h2 id="åŸç†æ€»ç»“"><a href="#åŸç†æ€»ç»“" class="headerlink" title="åŸç†æ€»ç»“"></a>åŸç†æ€»ç»“</h2><p>è¿™é‡Œçš„publishSubjectå°±æ˜¯åœ¨æˆ‘ä»¬å‘å‡ºé€šçŸ¥çš„æ—¶å€™æ‰ä¼šå»onNextï¼Œè€Œæˆ‘ä»¬çš„onNextæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å¹¶å‘è®¿é—®çš„æ—¶å€™ï¼Œå¯ä»¥ä¾æ¬¡æ‰§è¡ŒonNextï¼Œè¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°ofTypeè¿™ä¸ªæ“ä½œç¬¦ï¼Œç”¨æ¥è¿‡æ»¤TargetEvent.classçš„Observableæ¥å®ç°â€œå‘é€ç«¯â€ä¸â€œæ¥æ”¶ç«¯â€çš„çº¦æŸã€‚</p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>ç®€å•çš„ä½¿ç”¨æ–¹æ³•</p>
<h3 id="æ¶ˆæ¯å‘é€"><a href="#æ¶ˆæ¯å‘é€" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RxBus.getInstance().post(event);</div></pre></td></tr></table></figure>
<h3 id="æ¶ˆæ¯æ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œ"><a href="#æ¶ˆæ¯æ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œ" class="headerlink" title="æ¶ˆæ¯æ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œ"></a>æ¶ˆæ¯æ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œ</h3><p>è¿™é‡Œå°±ä¸ä»¥Activityï¼ŒFragmentåšå¯¹ç…§äº†ï¼ŒåŸºæœ¬ç”¨æ³•éƒ½ä¸€æ ·ï¼Œé£å‘ä¸€ä¸ªView AttachToWindow,DetachFromWindow çš„æ–¹å¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onAttachedToWindow();</div><div class="line">    mSubscription = RxBus.getInstance().toObserverable(IndexLeftBtnGetFocusEvent.class)</div><div class="line">            .compose(RxSchedulers.threadSwitchSchedulers())</div><div class="line">            .subscribe(event -&gt; &#123;</div><div class="line">                <span class="comment">// TODO ä¸šåŠ¡é€»è¾‘</span></div><div class="line">            &#125;);</div><div class="line"><span class="comment">//        EventBus.getDefault().register(this);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDetachedFromWindow();</div><div class="line">    <span class="keyword">if</span> (mSubscription.isUnsubscribed()) &#123;</div><div class="line">        mSubscription.unsubscribe();</div><div class="line">    &#125;</div><div class="line"><span class="comment">//        EventBus.getDefault().unregister(this);</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è¿™é‡Œæˆ‘åªæ˜¯å…ˆç”¨ä¸€ä¸ªå°demoæ¥å­¦ä¹ ä¸€ä¸‹è¿™é‡Œçš„ä»£ç è®¾è®¡ï¼ŒåæœŸä¼šå¯¹æˆ‘ä»¬çš„RxBusä¼˜åŒ–ï¼Œæ¯”å¦‚æ·»åŠ bindï¼Œunbindç”Ÿå‘½å‘¨æœŸçš„ç›¸å…³é€»è¾‘ã€‚</p>
]]></content>
      
        
        <tags>
            
            <tag> RxBus </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GreenDao æ•°æ®åº“å‡çº§æ•°æ®è¿ç§»]]></title>
      <url>/2017/04/22/GreenDao%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8D%87%E7%BA%A7%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘éœ€è¦è§£å†³GreenDao åœ¨è¿­ä»£å‡çº§æ•°æ®åº“æ—¶éœ€è¦åšæ•°æ®åº“è¿ç§»ã€‚ç»è¿‡æŸ¥èµ„æ–™è§£å†³äº†ï¼Œç«‹ä¸ªflagå¤‡å¿˜ã€‚ã€‚</p>
<h2 id="é—®é¢˜åˆ‡å…¥ç‚¹"><a href="#é—®é¢˜åˆ‡å…¥ç‚¹" class="headerlink" title="é—®é¢˜åˆ‡å…¥ç‚¹"></a>é—®é¢˜åˆ‡å…¥ç‚¹</h2><p>åœ¨GreenDao aptè‡ªåŠ¨ç”Ÿæˆçš„DaoMasterä»£ç <br><a id="more"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** WARNING: Drops all table on Upgrade! Use only during development. */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DevOpenHelper</span> <span class="keyword">extends</span> <span class="title">OpenHelper</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DevOpenHelper</span><span class="params">(Context context, String name, CursorFactory factory)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, name, factory);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</div><div class="line">        Log.i(<span class="string">"greenDAO"</span>, <span class="string">"Upgrading schema from version "</span> + oldVersion + <span class="string">" to "</span> + newVersion + <span class="string">" by dropping all tables"</span>);</div><div class="line">        dropAllTables(db, <span class="keyword">true</span>);</div><div class="line">        onCreate(db);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>GreenDao åœ¨æ ¹æ®æ•°æ®åº“ç‰ˆæœ¬å·å‡çº§çš„æ—¶å€™ä¼šæ‰§è¡ŒDevOpenHelperçš„onUpgradeæ–¹æ³•ï¼Œæˆ‘ä»¬ä¾æ¬¡çœ‹åˆ°dropAllTablesï¼ŒonCreateï¼Œå…ˆæ¸…é™¤æ‰€æœ‰çš„æ•°æ®è¡¨ï¼Œç„¶åé‡å»ºï¼Œè¿™æ ·æˆ‘ä»¬ä¸Šä¸€ä¸ªç‰ˆæœ¬æ˜¯æ•°æ®è¡¨é‡Œçš„è€æ•°æ®å°±è¢«dropæ‰äº†ã€‚æ‰€ä»¥æˆ‘ä»¬çš„åˆ‡å…¥ç‚¹å°±æ˜¯ç€è¿™é‡Œã€‚</p>
<h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>è¿™é‡Œæˆ‘ä»¬çš„åŸºæœ¬æ€è·¯æ˜¯ï¼š<br>1.å¯¹è€çš„æ•°æ®è¡¨é‡æ–°å‘½åï¼Œä½œä¸ºä¸´æ—¶æ•°æ®è¡¨<br>2.å»ºç«‹æ–°çš„æ•°æ®è¡¨<br>3.å°†ä¸´æ—¶æ•°æ®è¡¨çš„æ‰€æœ‰æ•°æ®è¿ç§»åˆ°æ–°çš„æ•°æ®è¡¨<br>4.åˆ é™¤ä¸´æ—¶æ•°æ®è¡¨<br>è¿™é‡Œæˆ‘ä»¬ç»Ÿç­¹ç”¨MigrationHelperç®¡ç†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">migrate</span><span class="params">(SQLiteDatabase db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses)</span> </span>&#123;</div><div class="line">    <span class="comment">// 1 æ–°å»ºä¸´æ—¶è¡¨</span></div><div class="line">    generateTempTables(db, daoClasses);</div><div class="line">    <span class="comment">// 2 åˆ›å»ºæ–°è¡¨</span></div><div class="line">    createAllTables(db, <span class="keyword">false</span>, daoClasses);</div><div class="line">    <span class="comment">// 3 ä¸´æ—¶è¡¨æ•°æ®å†™å…¥æ–°è¡¨ï¼Œåˆ é™¤ä¸´æ—¶è¡¨</span></div><div class="line">    restoreData(db, daoClasses);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="step-1"><a href="#step-1" class="headerlink" title="step.1"></a>step.1</h3><p>å°†è€çš„æ•°æ®è¡¨é‡å‘½å **_TEMP<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateTempTables</span><span class="params">(SQLiteDatabase db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; daoClasses.length; i++) &#123;</div><div class="line">        DaoConfig daoConfig = <span class="keyword">new</span> DaoConfig(db, daoClasses[i]);</div><div class="line">        String tableName = daoConfig.tablename;</div><div class="line">        <span class="keyword">if</span> (!checkTable(db, tableName))</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        String tempTableName = daoConfig.tablename.concat(<span class="string">"_TEMP"</span>);</div><div class="line">        StringBuilder insertTableStringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        insertTableStringBuilder.append(<span class="string">"alter table "</span>)</div><div class="line">                .append(tableName)</div><div class="line">                .append(<span class="string">" rename to "</span>)</div><div class="line">                .append(tempTableName)</div><div class="line">                .append(<span class="string">";"</span>);</div><div class="line">        db.execSQL(insertTableStringBuilder.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkTable</span><span class="params">(SQLiteDatabase db, String tableName)</span> </span>&#123;</div><div class="line">    StringBuilder query = <span class="keyword">new</span> StringBuilder();</div><div class="line">    query.append(<span class="string">"SELECT count(*) FROM sqlite_master WHERE type='table' AND name='"</span>)</div><div class="line">            .append(tableName)</div><div class="line">            .append(<span class="string">"'"</span>);</div><div class="line">    Cursor c = db.rawQuery(query.toString(), <span class="keyword">null</span>);</div><div class="line">    <span class="keyword">if</span> (c.moveToNext()) &#123;</div><div class="line">        <span class="keyword">int</span> count = c.getInt(<span class="number">0</span>);</div><div class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œä»ç³»ç»Ÿè¡¨ sqlite_master é‡Œé¢æŸ¥éœ€è¦è¿ç§»æ•°æ®çš„è¡¨æ˜¯å¦å­˜åœ¨</p>
<h3 id="step-2"><a href="#step-2" class="headerlink" title="step.2"></a>step.2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createAllTables</span><span class="params">(SQLiteDatabase db, <span class="keyword">boolean</span> ifNotExits, @NonNull Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses)</span> </span>&#123;</div><div class="line">    reflectMethod(db, <span class="string">"createTable"</span>, ifNotExits, daoClasses);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reflectMethod</span><span class="params">(SQLiteDatabase db, String methodName, <span class="keyword">boolean</span> isExists, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (daoClasses.length &lt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">for</span> (Class cls : daoClasses) &#123;</div><div class="line">            Method method = cls.getDeclaredMethod(methodName, SQLiteDatabase.class, <span class="keyword">boolean</span>.class);</div><div class="line">            method.invoke(<span class="keyword">null</span>, db, isExists);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”±äºçˆ¶ç±»AbstractDaoä¸å­˜åœ¨createTableè¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯åœ¨æ¯ä¸ªå­ç±»çš„<em>*</em>Daoå®ç°äº†createTableè¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨åå°„æ¥è·å¾—è¿™ä¸ªæ–¹æ³•ï¼Œæ¥åšå»ºç«‹æ–°çš„è¡¨ç»“æ„æ“ä½œã€‚</p>
<h3 id="step-3"><a href="#step-3" class="headerlink" title="step.3"></a>step.3</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">restoreData</span><span class="params">(SQLiteDatabase db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; daoClasses.length; i++) &#123;</div><div class="line">        DaoConfig daoConfig = <span class="keyword">new</span> DaoConfig(db, daoClasses[i]);</div><div class="line">        String tableName = daoConfig.tablename;</div><div class="line">        String tempTableName = daoConfig.tablename.concat(<span class="string">"_TEMP"</span>);</div><div class="line">        <span class="keyword">if</span> (!checkTable(db,tempTableName))</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        List&lt;String&gt; columns = getColumns(db, tempTableName);</div><div class="line">        ArrayList&lt;String&gt; properties = <span class="keyword">new</span> ArrayList&lt;&gt;(columns.size());</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; daoConfig.properties.length; j++) &#123;</div><div class="line">            String columnName = daoConfig.properties[j].columnName;</div><div class="line">            <span class="keyword">if</span> (columns.contains(columnName)) &#123;</div><div class="line">                properties.add(columnName);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (properties.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">final</span> String columnSQL = TextUtils.join(<span class="string">","</span>, properties);</div><div class="line">            StringBuilder insertTableStringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">            insertTableStringBuilder.append(<span class="string">"INSERT INTO "</span>)</div><div class="line">                    .append(tableName)</div><div class="line">                    .append(<span class="string">" ("</span>)</div><div class="line">                    .append(columnSQL)</div><div class="line">                    .append(<span class="string">") SELECT "</span>)</div><div class="line">                    .append(columnSQL)</div><div class="line">                    .append(<span class="string">" FROM "</span>)</div><div class="line">                    .append(tempTableName)</div><div class="line">                    .append(<span class="string">";"</span>);</div><div class="line"></div><div class="line">            db.execSQL(insertTableStringBuilder.toString());</div><div class="line">        &#125;</div><div class="line">        StringBuilder dropTableStringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        dropTableStringBuilder.append(<span class="string">"DROP TABLE "</span>).append(tempTableName);</div><div class="line">        db.execSQL(dropTableStringBuilder.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getColumns</span><span class="params">(SQLiteDatabase db, String tableName)</span> </span>&#123;</div><div class="line">    List&lt;String&gt; columns = <span class="keyword">null</span>;</div><div class="line">    Cursor cursor = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        cursor = db.rawQuery(<span class="string">"SELECT * FROM "</span> + tableName + <span class="string">" limit 0"</span>, <span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != cursor &amp;&amp; cursor.getColumnCount() &gt; <span class="number">0</span>) &#123;</div><div class="line">            columns = Arrays.asList(cursor.getColumnNames());</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">if</span> (cursor != <span class="keyword">null</span>)</div><div class="line">            cursor.close();</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == columns)</div><div class="line">            columns = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> columns;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±æ˜¯ç®€å•çš„ä»è€è¡¨æ‹¿æ•°æ®insertåˆ°æ–°çš„è¡¨ç»“æ„é‡Œé¢ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®å…·ä½“é¡¹ç›®æ¥è¿›è¡Œæ’å…¥ã€‚</p>
]]></content>
      
        
        <tags>
            
            <tag> Android ç¬¬ä¸‰æ–¹ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android ä¸¢å¸§åŸç†ä»¥åŠåŠæ³•]]></title>
      <url>/2017/01/22/Android%20%E4%B8%A2%E5%B8%A7%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E5%8A%9E%E6%B3%95/</url>
      <content type="html"><![CDATA[<h2 id="æ¥è¿‘å¹´åº•ï¼Œæƒ³åˆ†äº«ç‚¹å„¿ä¸œè¥¿ç»™å¤§å®¶ã€‚"><a href="#æ¥è¿‘å¹´åº•ï¼Œæƒ³åˆ†äº«ç‚¹å„¿ä¸œè¥¿ç»™å¤§å®¶ã€‚" class="headerlink" title="æ¥è¿‘å¹´åº•ï¼Œæƒ³åˆ†äº«ç‚¹å„¿ä¸œè¥¿ç»™å¤§å®¶ã€‚"></a>æ¥è¿‘å¹´åº•ï¼Œæƒ³åˆ†äº«ç‚¹å„¿ä¸œè¥¿ç»™å¤§å®¶ã€‚</h2><h2 id="Android-UIç»˜åˆ¶è¿‡ç¨‹"><a href="#Android-UIç»˜åˆ¶è¿‡ç¨‹" class="headerlink" title="Android UIç»˜åˆ¶è¿‡ç¨‹"></a>Android UIç»˜åˆ¶è¿‡ç¨‹</h2><p>å¼€å‘ä¸­çš„å¡é¡¿æˆ‘æƒ³æ²¡è·Ÿäººéƒ½é‡åˆ°è¿‡ï¼Œä¹‹å‰ä¹Ÿæ˜¯æœåšå®¢çœ‹çœ‹æ€ä¹ˆä¸ªè§£å†³åŠæ³•ï¼Œæ²¡æœ‰è®¤çœŸç ”ç©¶è¿‡ï¼Œä»Šå¤©æˆ‘æ‰“ç®—è·Ÿå¤§å®¶èŠä¸€èŠã€‚</p>
<p>å…ˆä»View è¯´å§ã€‚ç›¸ä¿¡å¤§å®¶åº”è¯¥éƒ½çŸ¥é“Viewçš„ç»˜åˆ¶è¿‡ç¨‹ï¼Œmeasureï¼Œlayoutï¼Œdrawã€‚ä¸¢å¸§ä¸€å®šæ˜¯åœ¨16mså†…æ²¡æœ‰æŠŠè¿™äº›äº‹å„¿å¹²å®Œå°±å¯¹äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•çš„åˆ†ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯è®¡ç®—æ—¶é—´ï¼Œä»¥åŠç»˜å›¾æ—¶é—´ã€‚</p>
<a id="more"></a>
<p>è®¡ç®—æ—¶é—´ï¼šè¿™é‡Œçš„measureï¼Œlayoutçš„è¿‡ç¨‹ï¼Œéƒ½æ˜¯ä¼šå‘ä¸‹é€’å½’è®¡ç®—çš„ï¼Œå­¦è¿‡æ•°æ®ç»“æ„çš„è¯ï¼Œåº”è¯¥çŸ¥é“ï¼Œæ·±æœçš„ä»£ä»·æ˜¯å¾ˆå¤§çš„ã€‚æ‰€ä»¥å°½é‡è®©æ ‘çš„é«˜åº¦é™ä½ï¼Œè¿™é‡Œå°±å¼•å‡ºæ‰å¹³åŒ–å¸ƒå±€ã€‚</p>
<p>ç»˜å›¾æ—¶é—´ï¼šè¿™é‡Œéœ€è¦ç€é‡è®²ä¸€ä¸‹ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™æ‰æ˜¯æˆ‘ä»¬UIå¡é¡¿çš„ä¸»è¦åŸå› ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬è¦æŠŠandroidçš„è¯•å›¾çœ‹æˆæ˜¯ä¸‰ç»´çš„ï¼Œå°±åƒphotoshopçš„å›¾å±‚ä¸€æ ·ã€‚androidåœ¨ç»˜åˆ¶çš„æ—¶å€™å°±ä¼šä¸€å±‚ä¸€å±‚çš„â€œç²‰åˆ·â€ï¼Œå¥½äº†ï¼Œé‚£ä¹ˆé€ æˆå¡é¡¿ï¼Œä¹Ÿå°±æ˜¯ä¸¢å¸§ï¼Œè¯´ç™½äº†æœ€åæ²¡æœ‰åœ¨16mså†…åšå®Œã€‚å¥½äº†ï¼Œè®©æˆ‘ä»¬å‰–æä¸€ä¸‹ï¼š</p>
<h3 id="invalidate-ï¼š"><a href="#invalidate-ï¼š" class="headerlink" title="invalidate()ï¼š"></a>invalidate()ï¼š</h3><p>æˆ‘ä»¬çŸ¥é“invalidate æ˜¯ç”¨æ¥è¯·æ±‚View é‡ç»˜çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Propagate the damage rectangle to the parent view.</span></div><div class="line"><span class="keyword">final</span> AttachInfo ai = mAttachInfo;</div><div class="line"><span class="keyword">final</span> ViewParent p = mParent;</div><div class="line"><span class="keyword">if</span> (p != <span class="keyword">null</span> &amp;&amp; ai != <span class="keyword">null</span> &amp;&amp; l &lt; r &amp;&amp; t &lt; b) &#123;</div><div class="line">    <span class="keyword">final</span> Rect damage = ai.mTmpInvalRect;</div><div class="line">    damage.set(l, t, r, b);</div><div class="line">    p.invalidateChild(<span class="keyword">this</span>, damage);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>invalidateInternal<br>è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥drawçš„è¿‡ç¨‹å…¶å®å°±æ˜¯æ‹¿åˆ°AttachInfo é‡Œé¢åŒ…å«ç€ç»˜åˆ¶ä¿¡æ¯ï¼Œä»¥åŠå°†ç»˜åˆ¶åŒºåŸŸæ‹¿åˆ°ï¼Œé€šè¿‡parentå»ç»˜åˆ¶ã€‚è®©æˆ‘ä»¬è·Ÿè¿›å»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> ViewParent <span class="title">invalidateChildInParent</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>[] location, <span class="keyword">final</span> Rect dirty)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_DRAWN) == PFLAG_DRAWN ||</div><div class="line">            (mPrivateFlags &amp; PFLAG_DRAWING_CACHE_VALID) == PFLAG_DRAWING_CACHE_VALID) &#123;</div><div class="line">        <span class="keyword">if</span> ((mGroupFlags &amp; (FLAG_OPTIMIZE_INVALIDATE | FLAG_ANIMATION_DONE)) !=</div><div class="line">                    FLAG_OPTIMIZE_INVALIDATE) &#123;</div><div class="line">            dirty.offset(location[CHILD_LEFT_INDEX] - mScrollX,</div><div class="line">                    location[CHILD_TOP_INDEX] - mScrollY);</div><div class="line">            <span class="keyword">if</span> ((mGroupFlags &amp; FLAG_CLIP_CHILDREN) == <span class="number">0</span>) &#123;</div><div class="line">                dirty.union(<span class="number">0</span>, <span class="number">0</span>, mRight - mLeft, mBottom - mTop);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> left = mLeft;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> top = mTop;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> ((mGroupFlags &amp; FLAG_CLIP_CHILDREN) == FLAG_CLIP_CHILDREN) &#123;</div><div class="line">                <span class="keyword">if</span> (!dirty.intersect(<span class="number">0</span>, <span class="number">0</span>, mRight - left, mBottom - top)) &#123;</div><div class="line">                    dirty.setEmpty();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            mPrivateFlags &amp;= ~PFLAG_DRAWING_CACHE_VALID;</div><div class="line"></div><div class="line">            location[CHILD_LEFT_INDEX] = left;</div><div class="line">            location[CHILD_TOP_INDEX] = top;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mLayerType != LAYER_TYPE_NONE) &#123;</div><div class="line">                mPrivateFlags |= PFLAG_INVALIDATED;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> mParent;</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mPrivateFlags &amp;= ~PFLAG_DRAWN &amp; ~PFLAG_DRAWING_CACHE_VALID;</div><div class="line"></div><div class="line">            location[CHILD_LEFT_INDEX] = mLeft;</div><div class="line">            location[CHILD_TOP_INDEX] = mTop;</div><div class="line">            <span class="keyword">if</span> ((mGroupFlags &amp; FLAG_CLIP_CHILDREN) == FLAG_CLIP_CHILDREN) &#123;</div><div class="line">                dirty.set(<span class="number">0</span>, <span class="number">0</span>, mRight - mLeft, mBottom - mTop);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// in case the dirty rect extends outside the bounds of this container</span></div><div class="line">                dirty.union(<span class="number">0</span>, <span class="number">0</span>, mRight - mLeft, mBottom - mTop);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mLayerType != LAYER_TYPE_NONE) &#123;</div><div class="line">                mPrivateFlags |= PFLAG_INVALIDATED;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> mParent;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>invalidateChildInParent<br>è¿™é‡Œçš„dirtyä»£è¡¨ä½ ç»˜åˆ¶çš„è¿™å—åŒºåŸŸæ˜¯å¦é€æ˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">invalidate</span><span class="params">()</span> </span>&#123;</div><div class="line">    mDirty.set(<span class="number">0</span>, <span class="number">0</span>, mWidth, mHeight);</div><div class="line">    <span class="keyword">if</span> (!mWillDrawSoon) &#123;</div><div class="line">        scheduleTraversals();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>invalidate<br>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸ªå…³é”®å‡½æ•° scheduleTraversals ï¼Œä¸ºä»€ä¹ˆè¯´ç¥å¥‡ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">scheduleTraversals</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!mTraversalScheduled) &#123;</div><div class="line">        mTraversalScheduled = <span class="keyword">true</span>;</div><div class="line">        mTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();</div><div class="line">        mChoreographer.postCallback(</div><div class="line">                Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, <span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (!mUnbufferedInputDispatch) &#123;</div><div class="line">            scheduleConsumeBatchedInput();</div><div class="line">        &#125;</div><div class="line">        notifyRendererOfFramePending();</div><div class="line">        pokeDrawLockIfNeeded();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>scheduleTraversals<br>è¿™é‡Œæœ€é‡è¦çš„æ˜¯Choreographer è¿™ä¸ªï¼Œæˆ‘ä»¬æœ€ç»ˆç®—å‡ºæ¥çš„ç»˜åˆ¶ä¿¡æ¯éƒ½è¦é€šè¿‡å®ƒå›è°ƒï¼Œå¼€å§‹ä»–ä¼šæ³¨å†Œä¸€ä¸ªå¹¿æ’­ç”¨æ¥æ¥æ”¶æ—¶é’Ÿä¿¡æ¯ï¼Œç„¶åä»–ä¼šåœ¨å†…éƒ¨å»ºç«‹ä¸€ä¸ªUIç»˜åˆ¶é˜Ÿåˆ—ï¼šCallbackQueueï¼Œæˆ‘ä»¬åœ¨å¤–éƒ¨CallBackçš„æ—¶å€™ï¼Œä¼šå°†æˆ‘ä»¬çš„ç»˜åˆ¶ä¿¡æ¯ä½œä¸ºCallbackRecord ç„¶åä¼šåœ¨æ¥æ”¶åˆ°ä¸€ä¸ªæ—¶é’Ÿä¿¡å·çš„æ—¶å€™è¿›è¡ŒdoFrameæ“ä½œï¼Œå¹¶æ‰“å°Tracesä¿¡æ¯ï¼Œä»è€Œæ¥ç»˜åˆ¶ä¸€å¸§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbackRecord</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> CallbackRecord next;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">long</span> dueTime;</div><div class="line">    <span class="keyword">public</span> Object action; <span class="comment">// Runnable or FrameCallback</span></div><div class="line">    <span class="keyword">public</span> Object token;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">long</span> frameTimeNanos)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (token == FRAME_CALLBACK_TOKEN) &#123;</div><div class="line">            ((FrameCallback)action).doFrame(frameTimeNanos);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ((Runnable)action).run();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbackQueue</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> CallbackRecord mHead;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasDueCallbacksLocked</span><span class="params">(<span class="keyword">long</span> now)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mHead != <span class="keyword">null</span> &amp;&amp; mHead.dueTime &lt;= now;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> CallbackRecord <span class="title">extractDueCallbacksLocked</span><span class="params">(<span class="keyword">long</span> now)</span> </span>&#123;</div><div class="line">        CallbackRecord callbacks = mHead;</div><div class="line">        <span class="keyword">if</span> (callbacks == <span class="keyword">null</span> || callbacks.dueTime &gt; now) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        CallbackRecord last = callbacks;</div><div class="line">        CallbackRecord next = last.next;</div><div class="line">        <span class="keyword">while</span> (next != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (next.dueTime &gt; now) &#123;</div><div class="line">                last.next = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            last = next;</div><div class="line">            next = next.next;</div><div class="line">        &#125;</div><div class="line">        mHead = next;</div><div class="line">        <span class="keyword">return</span> callbacks;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCallbackLocked</span><span class="params">(<span class="keyword">long</span> dueTime, Object action, Object token)</span> </span>&#123;</div><div class="line">        CallbackRecord callback = obtainCallbackLocked(dueTime, action, token);</div><div class="line">        CallbackRecord entry = mHead;</div><div class="line">        <span class="keyword">if</span> (entry == <span class="keyword">null</span>) &#123;</div><div class="line">            mHead = callback;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (dueTime &lt; entry.dueTime) &#123;</div><div class="line">            callback.next = entry;</div><div class="line">            mHead = callback;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (entry.next != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (dueTime &lt; entry.next.dueTime) &#123;</div><div class="line">                callback.next = entry.next;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            entry = entry.next;</div><div class="line">        &#125;</div><div class="line">        entry.next = callback;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeCallbacksLocked</span><span class="params">(Object action, Object token)</span> </span>&#123;</div><div class="line">        CallbackRecord predecessor = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">for</span> (CallbackRecord callback = mHead; callback != <span class="keyword">null</span>;) &#123;</div><div class="line">            <span class="keyword">final</span> CallbackRecord next = callback.next;</div><div class="line">            <span class="keyword">if</span> ((action == <span class="keyword">null</span> || callback.action == action)</div><div class="line">                    &amp;&amp; (token == <span class="keyword">null</span> || callback.token == token)) &#123;</div><div class="line">                <span class="keyword">if</span> (predecessor != <span class="keyword">null</span>) &#123;</div><div class="line">                    predecessor.next = next;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    mHead = next;</div><div class="line">                &#125;</div><div class="line">                recycleCallbackLocked(callback);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                predecessor = callback;</div><div class="line">            &#125;</div><div class="line">            callback = next;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>CallbackQueue and CallbackRecord</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postCallbackDelayedInternal</span><span class="params">(<span class="keyword">int</span> callbackType,</span></span></div><div class="line">            Object action, Object token, <span class="keyword">long</span> delayMillis) &#123;</div><div class="line">    <span class="keyword">if</span> (DEBUG_FRAMES) &#123;</div><div class="line">        Log.d(TAG, <span class="string">"PostCallback: type="</span> + callbackType</div><div class="line">                + <span class="string">", action="</span> + action + <span class="string">", token="</span> + token</div><div class="line">                + <span class="string">", delayMillis="</span> + delayMillis);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> dueTime = now + delayMillis;</div><div class="line">        mCallbackQueues[callbackType].addCallbackLocked(dueTime, action, token);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (dueTime &lt;= now) &#123;</div><div class="line">            scheduleFrameLocked(now);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_CALLBACK, action);</div><div class="line">            msg.arg1 = callbackType;</div><div class="line">            msg.setAsynchronous(<span class="keyword">true</span>);</div><div class="line">            mHandler.sendMessageAtTime(msg, dueTime);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>postCallbackDelayedInternal<br>å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬æŠŠæˆ‘ä»¬çš„ç»˜åˆ¶å†…å®¹æ‰”åˆ°é˜Ÿåˆ—é‡Œï¼Œç­‰å¾…è½®è®­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FrameDisplayEventReceiver</span> <span class="keyword">extends</span> <span class="title">DisplayEventReceiver</span></span></div><div class="line">            <span class="keyword">implements</span> <span class="title">Runnable</span> &#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mHavePendingVsync;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mTimestampNanos;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mFrame;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FrameDisplayEventReceiver</span><span class="params">(Looper looper)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(looper);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onVsync</span><span class="params">(<span class="keyword">long</span> timestampNanos, <span class="keyword">int</span> builtInDisplayId, <span class="keyword">int</span> frame)</span> </span>&#123;</div><div class="line">        <span class="comment">// Ignore vsync from secondary display.</span></div><div class="line">        <span class="comment">// This can be problematic because the call to scheduleVsync() is a one-shot.</span></div><div class="line">        <span class="comment">// We need to ensure that we will still receive the vsync from the primary</span></div><div class="line">        <span class="comment">// display which is the one we really care about.  Ideally we should schedule</span></div><div class="line">        <span class="comment">// vsync for a particular display.</span></div><div class="line">        <span class="comment">// At this time Surface Flinger won't send us vsyncs for secondary displays</span></div><div class="line">        <span class="comment">// but that could change in the future so let's log a message to help us remember</span></div><div class="line">        <span class="comment">// that we need to fix this.</span></div><div class="line">        <span class="keyword">if</span> (builtInDisplayId != SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN) &#123;</div><div class="line">            Log.d(TAG, <span class="string">"Received vsync from secondary display, but we don't support "</span></div><div class="line">                    + <span class="string">"this case yet.  Choreographer needs a way to explicitly request "</span></div><div class="line">                    + <span class="string">"vsync for a specific display to ensure it doesn't lose track "</span></div><div class="line">                    + <span class="string">"of its scheduled vsync."</span>);</div><div class="line">            scheduleVsync();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Post the vsync event to the Handler.</span></div><div class="line">        <span class="comment">// The idea is to prevent incoming vsync events from completely starving</span></div><div class="line">        <span class="comment">// the message queue.  If there are no messages in the queue with timestamps</span></div><div class="line">        <span class="comment">// earlier than the frame time, then the vsync event will be processed immediately.</span></div><div class="line">        <span class="comment">// Otherwise, messages that predate the vsync event will be handled first.</span></div><div class="line">        <span class="keyword">long</span> now = System.nanoTime();</div><div class="line">        <span class="keyword">if</span> (timestampNanos &gt; now) &#123;</div><div class="line">            Log.w(TAG, <span class="string">"Frame time is "</span> + ((timestampNanos - now) * <span class="number">0.000001f</span>)</div><div class="line">                    + <span class="string">" ms in the future!  Check that graphics HAL is generating vsync "</span></div><div class="line">                    + <span class="string">"timestamps using the correct timebase."</span>);</div><div class="line">            timestampNanos = now;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mHavePendingVsync) &#123;</div><div class="line">            Log.w(TAG, <span class="string">"Already have a pending vsync event.  There should only be "</span></div><div class="line">                    + <span class="string">"one at a time."</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mHavePendingVsync = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mTimestampNanos = timestampNanos;</div><div class="line">        mFrame = frame;</div><div class="line">        Message msg = Message.obtain(mHandler, <span class="keyword">this</span>);</div><div class="line">        msg.setAsynchronous(<span class="keyword">true</span>);</div><div class="line">        mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        mHavePendingVsync = <span class="keyword">false</span>;</div><div class="line">        doFrame(mTimestampNanos, mFrame);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>FrameDisplayEventReceiver<br>æ¥æ”¶æ—¶é’Ÿè„‰å†²ä¿¡å·çš„å¹¿æ’­ï¼Œ16msä¸€æ¬¡ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯åœ¨è¿™ä¸ªæ—¶é’Ÿè„‰å†²é‡Œæå®šæ•´ä¸ª view</p>
<h3 id="Android-åŠ¨ç”»"><a href="#Android-åŠ¨ç”»" class="headerlink" title="Android åŠ¨ç”»"></a>Android åŠ¨ç”»</h3><p>Animatorï¼ŒScrollToï¼ŒoffsetLeftAndRightï¼Œè¿™é‡Œé¢æˆ‘ä»¬å…ˆå•åˆ—è¿™å‡ é¡¹ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªåŸç†ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„çŒœæƒ³ï¼Œä¸€å®šæ˜¯é¢‘ç¹æ‰§è¡Œæˆ‘ä»¬çš„ Choreographer.CallBack æ¥ç»˜åˆ¶ï¼Œå› ä¸ºåªè¦åœ¨16mså†…ç»˜åˆ¶æˆåŠŸï¼Œé‚£å°±æ˜¯æµç•…çš„åŠ¨ç”»ã€‚ä¸‹é¢æˆ‘ä»¬éªŒè¯ä¸€ä¸‹</p>
<p>ScrollTo:</p>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ View ä¸­è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollTo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mScrollX != x || mScrollY != y) &#123;</div><div class="line">        <span class="keyword">int</span> oldX = mScrollX;</div><div class="line">        <span class="keyword">int</span> oldY = mScrollY;</div><div class="line">        mScrollX = x;</div><div class="line">        mScrollY = y;</div><div class="line">        invalidateParentCaches();</div><div class="line">        onScrollChanged(mScrollX, mScrollY, oldX, oldY);</div><div class="line">        <span class="keyword">if</span> (!awakenScrollBars()) &#123;</div><div class="line">            postInvalidateOnAnimation();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>scrollTo<br>å¾ˆç®€å•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹æ‡‚ï¼Œå¼€å§‹ä½ç½®ï¼Œç»“æŸä½ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ postInvalidateOnAnimation()  è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postInvalidateOnAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// We try only with the AttachInfo because there's no point in invalidating</span></div><div class="line">    <span class="comment">// if we are not attached to our window</span></div><div class="line">    <span class="keyword">final</span> AttachInfo attachInfo = mAttachInfo;</div><div class="line">    <span class="keyword">if</span> (attachInfo != <span class="keyword">null</span>) &#123;</div><div class="line">        attachInfo.mViewRootImpl.dispatchInvalidateOnAnimation(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>postInvalidateOnAnimation<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„åŠ¨ç”»è¿‡ç¨‹ç»˜åˆ¶ä»–è¿˜æ˜¯æ‰”åˆ°äº†ViewRootImpl ä»£ç†åšè¿™ä»¶äº‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchInvalidateRectOnAnimation</span><span class="params">(AttachInfo.InvalidateInfo info)</span> </span>&#123;</div><div class="line">    mInvalidateOnAnimationRunnable.addViewRect(info);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>dispatchInvalidateOnAnimation<br>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä»–å¼€äº†ä¸ªçº¿ç¨‹ mInvalidateOnAnimationRunnable å»æ·»åŠ æˆ‘ä»¬è¿™ä¸ªå°†è¦ç»˜åˆ¶çš„ viewï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åº–ä¸è§£ç‰›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InvalidateOnAnimationRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mPosted;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="keyword">new</span> ArrayList&lt;View&gt;();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;AttachInfo.InvalidateInfo&gt; mViewRects =</div><div class="line">            <span class="keyword">new</span> ArrayList&lt;AttachInfo.InvalidateInfo&gt;();</div><div class="line">    <span class="keyword">private</span> View[] mTempViews;</div><div class="line">    <span class="keyword">private</span> AttachInfo.InvalidateInfo[] mTempViewRects;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            mViews.add(view);</div><div class="line">            postIfNeededLocked();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewRect</span><span class="params">(AttachInfo.InvalidateInfo info)</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            mViewRects.add(info);</div><div class="line">            postIfNeededLocked();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeView</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            mViews.remove(view);</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mViewRects.size(); i-- &gt; <span class="number">0</span>; ) &#123;</div><div class="line">                AttachInfo.InvalidateInfo info = mViewRects.get(i);</div><div class="line">                <span class="keyword">if</span> (info.target == view) &#123;</div><div class="line">                    mViewRects.remove(i);</div><div class="line">                    info.recycle();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mPosted &amp;&amp; mViews.isEmpty() &amp;&amp; mViewRects.isEmpty()) &#123;</div><div class="line">                mChoreographer.removeCallbacks(Choreographer.CALLBACK_ANIMATION, <span class="keyword">this</span>, <span class="keyword">null</span>);</div><div class="line">                mPosted = <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> viewCount;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> viewRectCount;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            mPosted = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">            viewCount = mViews.size();</div><div class="line">            <span class="keyword">if</span> (viewCount != <span class="number">0</span>) &#123;</div><div class="line">                mTempViews = mViews.toArray(mTempViews != <span class="keyword">null</span></div><div class="line">                        ? mTempViews : <span class="keyword">new</span> View[viewCount]);</div><div class="line">                mViews.clear();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            viewRectCount = mViewRects.size();</div><div class="line">            <span class="keyword">if</span> (viewRectCount != <span class="number">0</span>) &#123;</div><div class="line">                mTempViewRects = mViewRects.toArray(mTempViewRects != <span class="keyword">null</span></div><div class="line">                        ? mTempViewRects : <span class="keyword">new</span> AttachInfo.InvalidateInfo[viewRectCount]);</div><div class="line">                mViewRects.clear();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; viewCount; i++) &#123;</div><div class="line">            mTempViews[i].invalidate();</div><div class="line">            mTempViews[i] = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; viewRectCount; i++) &#123;</div><div class="line">            <span class="keyword">final</span> View.AttachInfo.InvalidateInfo info = mTempViewRects[i];</div><div class="line">            info.target.invalidate(info.left, info.top, info.right, info.bottom);</div><div class="line">            info.recycle();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postIfNeededLocked</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!mPosted) &#123;</div><div class="line">            mChoreographer.postCallback(Choreographer.CALLBACK_ANIMATION, <span class="keyword">this</span>, <span class="keyword">null</span>);</div><div class="line">            mPosted = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>InvalidateOnAnimationRunnable<br>ç»ˆäºï¼Œåº”äº†æˆ‘ä»¬çš„çŒœæƒ³ï¼ŒViewRootImpl æœ‰ä¸€ä¸ªä¸“é—¨æ‰§è¡ŒåŠ¨ç”»ç»˜åˆ¶æ“ä½œçš„çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° run() é‡Œé¢ä¸æ–­åœ°CallBackï¼Œç„¶åå›æ”¶ï¼Œå½“ç„¶é‡Œé¢æœ‰äº›çº¿ç¨‹é”å•¥çš„ä¸æ¶‰åŠæœ¬æ–‡å°±ä¸ç»†è¯´äº†ã€‚</p>
<h3 id="ValueAnimatorï¼š"><a href="#ValueAnimatorï¼š" class="headerlink" title="ValueAnimatorï¼š"></a>ValueAnimatorï¼š</h3><p>è¿™é‡Œæˆ‘ä»¬æœ‰ä¸ª AnimationHandler æ¥æ‰§è¡ŒåŠ¨ç”»æ“ä½œï¼Œè¿™å…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numAnims; ++i) &#123;</div><div class="line">    ValueAnimator anim = mTmpAnimations.get(i);</div><div class="line">    <span class="keyword">if</span> (mAnimations.contains(anim) &amp;&amp; anim.doAnimationFrame(frameTime)) &#123;</div><div class="line">        mEndingAnims.add(anim);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">mTmpAnimations.clear();</div></pre></td></tr></table></figure>
<p>doAnimationFrame<br>è¿™é‡Œåœ¨ä¸æ–­å¾ªç¯æˆ‘ä»¬æ‰€æœ‰çš„animï¼Œå¹¶åœ¨ä¸æ–­æ‰§è¡Œ scheduleAnimation æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!mAnimationScheduled) &#123;</div><div class="line">        mChoreographer.postCallback(Choreographer.CALLBACK_ANIMATION, mAnimate, <span class="keyword">null</span>);</div><div class="line">        mAnimationScheduled = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>scheduleAnimation<br>å‰©ä¸‹çš„å¤§å®¶è‡ªå·±ç¿»é˜…æºç æŠŠã€‚</p>
<p>è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚æˆ‘ä»¬æ‰€æœ‰ç•Œé¢ä¸Šè§†å›¾çš„å˜åŒ–éƒ½æ˜¯éƒ½æ˜¯ ViewRootImpl æŠŠéœ€è¦é‡ç»˜çš„ä¸œè¥¿å¡«å…… Choreographer ä¸­çš„ mCallbackQueues é˜Ÿåˆ—ï¼Œç„¶ååœ¨æ—¶é’Ÿè„‰å†²çš„å¹¿æ’­ä¸‹è¿›è¡Œè½®è®­æ‰§è¡Œã€‚</p>
<p>æ—¢ç„¶æåˆ°é˜Ÿåˆ—ï¼Œå‡å¦‚æˆ‘ä»¬åœ¨16mså†…å¤§é‡çš„å¡«å…… AttachInfo ä¹‹ç±»çš„ç»˜åˆ¶OBJï¼Œå°±ä¼šå¯¼è‡´æ— æ³•å†ä¸€æ¬¡æ—¶é’Ÿè„‰å†²å†…ç»˜åˆ¶å®Œæ¯•ï¼Œå°±ä¼šåœ¨é€ æˆä¸¢å¸§ï¼ŒUIé˜»å¡ã€‚</p>
<p>é¿å… Android UI å¡é¡¿è§£å†³åŠæ³•</p>
<p>è§£å†³åŠæ³•ï¼šåˆ†æäº†å¥½å¤šï¼Œè¿™é‡Œè¯´ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p>1.é¿å…é‡ç»˜ï¼Œè¿™é‡Œé¿å…å›¾å±‚ï¼ˆViewï¼‰è¿­ä»£ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥å»å¼€å‘è€…æ¨¡å¼ä¸­å¯¹â€œæ˜¾ç¤ºGPUè§†å›¾æ›´æ–°â€æ‰“é’©</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2710533-cade3554a7db68ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Alt text"></p>
<p>è¿‡åº¦ç»˜åˆ¶</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2710533-eb07b0f9a442d6f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Alt text"></p>
<p>ä¼˜åŒ–ä»¥å<br>è¿™é‡Œå¼•ç”¨ <a href="http://hukai.me/android-performance-render" target="_blank" rel="external">http://hukai.me/android-performance-render</a> è¿™ç¯‡åšå®¢çš„ä½œè€…ï¼Œç›—ä¸ªå›¾ã€‚ğŸ˜‚</p>
<p>è¿™é‡Œå¯ä»¥è¿›è¡Œï¼Œé€‰æ‹©åˆ¶å®šç”»å¸ƒç»˜åˆ¶ï¼Œè€Œä¸æ˜¯æ•´ä¸ªviewå»ç»˜åˆ¶ã€‚å¯ä»¥åœ¨onDrawä¸­è¿›è¡Œé™åˆ¶ï¼Œå»é™åˆ¶ç»˜åˆ¶åŒºåŸŸï¼Œä¾‹å¦‚</p>
<p>canvas.clipRect(100,100,350,600, Region.Op.INTERSECT);</p>
<p>2.æ‰å¹³åŒ–å¸ƒå±€ï¼Œå½’æ ¹ç»“åº•ä¹Ÿæ˜¯å‡å°‘ mCallbackQueues é˜Ÿåˆ—å¤§å°ã€‚ä¿è¯å°½é‡åœ¨16mså†…ç»˜åˆ¶å®Œæ¯•ï¼Œå†æœ‰å°±æ˜¯å¯ä»¥å‡å°‘è§†å›¾ ViewTree çš„é«˜åº¦ï¼Œå‡å°‘æ—¶é—´å¤æ‚åº¦ï¼Œä»è€Œä¼˜åŒ–è®¡ç®—è¿‡ç¨‹</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2710533-4c8e729db92f694a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Alt text"></p>
<p>xmlä»£ç </p>
<p><img src="http://upload-images.jianshu.io/upload_images/2710533-0dbcc3353bd36d2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Alt text"></p>
<p>ä¼˜åŒ–åçš„xmlä»£ç <br>ï¼Šé™„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2710533-5ddc05554c24d6d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Alt text"></p>
<p>ç»˜åˆ¶å±‚çº§<br>é€šè¿‡æ‰“å¼€åˆšæ‰è¯´çš„å¼€å‘è€…é€‰é¡¹ï¼Œæ¥æ ¹æ®é¢œè‰²æ¥åˆ¤æ–­é¡µé¢ç»˜åˆ¶æƒ…å†µã€‚</p>
<p>è·ç¦»å›å®¶è¿˜æœ‰8 ä¸ªå°æ—¶ï¼Œ17å¹´å¸Œæœ›å¯ä»¥å‘è§‰æ›´å¤šçš„ä¸œè¥¿ç»™å¤§å®¶ï¼Œå¹¶ä¸”å¸Œæœ›å¤§å®¶å¯ä»¥ç§¯ææŒ‡å‡ºæ–‡ç« ä¸­çš„é”™è¯¯ã€‚ç¥å¤§å®¶æ–°å¹´å¿«ä¹ï¼ğŸ˜„</p>
]]></content>
      
        
        <tags>
            
            <tag> Android æºç  </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Dagger2ä½“ä¼š]]></title>
      <url>/2016/08/11/Dagger2%E4%BD%93%E4%BC%9A/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åˆšæ¥æˆ‘å¸ï¼Œå¼€å§‹å…¥æ‰‹å…¬å¸çš„é¡¹ç›®ï¼ŒMVPï¼ŒRxJavaï¼ŒDagger2æ­å»ºçš„æ¡†æ¶ã€‚å¯¹äºæˆ‘è¿™ä¸ªåˆšæ²¡å¤šé•¿æ—¶é—´çš„Androidèœé¸Ÿï¼Œç€å®èŠ±äº†ä¸€æ®µæ—¶é—´ï¼Œè¯´ç‚¹å„¿é¢˜å¤–è¯ï¼Œæœ€è¿‘ç ”ç©¶äº†Java8ï¼Œå·²ç»å¼€å§‹ç”±å‘½ä»¤å¼ç¼–ç¨‹è¿‡åº¦åˆ°å‡½æ•°å¼ç¼–ç¨‹äº†ï¼Œå°¤å…¶æ˜¯åŠ äº†Lambdaè¡¨è¾¾å¼ï¼Œé…èµ·æ¥RxJavaçš„åˆ‡æ¢çº¿ç¨‹ï¼Œå¼‚æ­¥æ“ä½œçˆ½å‘†äº†ã€‚</p>
<p>è‡³äºMVPï¼Œå¼€å§‹æˆ‘æ˜¯åªçŸ¥é“MVCï¼Œä½†åœ¨çœ‹æˆ‘å¸çš„é¡¹ç›®æ¶æ„çš„æ—¶å€™å‘ç°æœ‰å·®åˆ«ï¼Œåæ¥åœ¨ç®€ä¹¦ä¸Šçœ‹åˆ°ä¸€ä¸ªåšä¸»ï¼Œé†é†çŒé¡¶ï¼Œæ˜ç™½äº†MVPå…¶å®è·ŸMVCæ˜¯ä¸ä¸€æ ·çš„ï¼Œå°±å•å•Modelæ¥è¯´ï¼Œåœ¨MVCä¸­åªæ˜¯æˆ‘ä»¬çš„ä¸€äº›javaBeanï¼Œè€Œåœ¨MVPå®ƒæ¶‰åŠåˆ°æ•°æ®çš„æ¥é¾™å»è„‰ï¼Œæ•°æ®æ˜¯æ¥è‡ªå†…å­˜ï¼Œç¡¬ç›˜ï¼Œè¿˜æ˜¯ç½‘ç»œã€‚å·²ç»æ•°æ®å°†ä¼šæ€æ ·å­˜å‚¨éƒ½åŒ…å«å…¶ä¸­ï¼Œè‡³äºMVçš„ä¸åŒï¼Œè¯·å¤§å®¶çœ‹<a href="https://hexo.io/" target="_blank" rel="external">MVP</a>ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è¿™ç¯‡åšå®¢çš„é‡ç‚¹äº†ï¼ŒDagger2ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æˆ–å¤šæˆ–å°‘ç”¨è¿‡æˆ–è€…å¬è¯´è¿‡ã€‚è®©å¤§å®¶æ´¥æ´¥ä¹é“çš„å°±æ˜¯å®ƒçš„ä¾èµ–æ³¨å…¥ï¼Œä¹‹å‰æœ‰ç­è§£è¿‡ä¾èµ–æ³¨å…¥ï¼ŒçŸ¥é“ä»–æœ€å¤§çš„å¥½å¤„æ˜¯è§£è—•ï¼Œå¤§å­¦æ—¶å€™æ²¡å¥½å¥½ç ”ç©¶ï¼Œä»Šå¤©æˆ‘æƒ³è¯´ä¸€ä¸‹æˆ‘çš„å¿ƒå¾—ã€‚<br><a id="more"></a></p>
<h2 id="å‡ ä¸ªç–‘é—®"><a href="#å‡ ä¸ªç–‘é—®" class="headerlink" title="å‡ ä¸ªç–‘é—®"></a>å‡ ä¸ªç–‘é—®</h2><h3 id="ä»€ä¹ˆæ˜¯è§£è€¦ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è§£è€¦ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è§£è€¦ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è§£è€¦ï¼Ÿ</h3><p>è§£è€¦å°±æ˜¯æ¾è€¦åˆï¼Œåœ¨æˆ‘ä»¬å¼€å§‹å­¦Javaçš„æ—¶å€™newè¿‡å„ç§äº‹ç‰©ï¼Œ(PSä¸–é—´ä¸‡ç‰©çš†å¯¹è±¡)ï¼Œä½†å½“å·¥ç¨‹å˜å¤§ï¼Œä½ çš„javaæ–‡ä»¶è¿‡å¤šï¼Œä¸€æ—¦éœ€æ±‚å¦¹å¦¹è¿‡æ¥è·Ÿä½ å¨‡æ»´æ»´çš„è¯´ï¼Œæ„é€ å‡½æ•°åŠ ä¸ªå‚æ•°å‘—ï¼Œæ¯•ç«Ÿæ˜¯å¦¹å­æ±‚ï¼Œæ€èƒ½ä¸ä»ï¼Œç„¶åä½ å¼€å§‹æ˜å¤©é»‘åœ°çš„æ‰¾ï¼Œè¿™ç§æœ€ç›´è§‚çš„ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„ä½“éªŒå°±æ˜¯è€¦åˆï¼Œå¾ˆç›´è§‚å§ã€‚å®˜æ–¹çš„è¯´æ³•å°±æ˜¯ï¼Œåœ¨Aä¸­new Bè¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼ŒB åªèƒ½åœ¨Aä¸­newï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¼±åŒ–è¿™ç§å…³ç³»ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ</h3><p>é‚£ä¹ˆä¾èµ–æ³¨å…¥è¿™ä¸ªæ€æƒ³æ˜¯ä»€ä¹ˆé‚£ï¼Œå‡è®¾Aéœ€è¦Bï¼Œæˆ‘ä»¬è¦åšçš„ä¸æ˜¯ç¡¬ç¼–ç new Bï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå·¥å‚å»ç”Ÿäº§å®ƒï¼Œä½ çœ‹åˆ°è¿™ä¸€å®šè’™è”½äº†ï¼Œå·¥å‚ä¸ä¹Ÿå¾—newå—ï¼Œè®²é“ç†ï¼Œæ˜¯è¿™æ ·ï¼Œä½†ä½ æƒ³ï¼Œå½“ä½ æƒ³æ”¹Bçš„æœ‰å‚æ„é€ æˆ–æ˜¯å…¶ä»–ï¼Œä½ åªéœ€è¦æ”¹ä»–çš„å·¥å‚ã€‚è®¾è®¡æ¨¡å¼å°±æ˜¯è¿™æ ·ï¼Œä½ å¯èƒ½ä¼šæ„Ÿè§‰ï¼Œå¥½éº»çƒ¦å•Šï¼Œæˆ‘å¼€å§‹ä¹Ÿæ˜¯è¿™æ ·ï¼Œè§‰å¾—æ˜æ˜å‡ è¡Œï¼Œä¸ºä»€ä¹ˆç”¨äº†è®¾è®¡æ¨¡å¼ä¼šè¿™ä¹ˆå¤šä»£ç ã€‚æ‹…å½“å¼€å§‹æ¥æ”¶é¡¹ç›®ï¼Œä½ ä¼šæ„Ÿè§‰è‡ªå·±çš„ä»£ç è¶Šå†™è¶Šéš¾ä»¥ç»´æŠ¤ï¼Œè—•åˆåº¦è¶Šé«˜ï¼Œæœ€ç›´è§‚çš„æ„Ÿå—ï¼Œå†™çš„è‡ªå·±éƒ½å¿ƒåŠ›äº¤ç˜ï¼Œç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œå¥½äº†ï¼Œå›å½’æ­£é¢˜ï¼Œè®¾æƒ³å‡å¦‚ä½ åœ¨100ä¸ªç±»é‡Œé¢new äº†Bï¼Œå½“Bæ”¹å˜çš„æ—¶å€™ä½ æ˜¯ä¸æ˜¯è¦å»ä¸€ä¸ªä¸ªæ”¹ï¼Œä½†æ˜¯å‡å¦‚ä½ åªæ˜¯ä¿®æ”¹ä»–çš„å·¥å‚é‚£å°±ä¸ç”¨äº†ï¼Œå› ä¸ºB çš„æºå¤´æ˜¯ä½ åœ¨ç”¨åˆ°å®ƒçš„æ—¶å€™ç”±å·¥å‚æ³¨å…¥ï¼Œæ— è®ºæ˜¯åˆå§‹åŒ–åŠ è½½ï¼Œè¿˜æ˜¯lazyåŠ è½½ï¼Œéƒ½ä¸€æ ·ã€‚</p>
<p>å…¶å®ä¾èµ–æ³¨å…¥æˆ‘ä»¬ä¸€å®šè§è¿‡ï¼Œè¿™é‡Œèšä¸€ä¸‹ä¾‹å­ï¼š</p>
<h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    B b;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">(B b)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.b = b;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="setæ–¹æ³•æ³¨å…¥"><a href="#setæ–¹æ³•æ³¨å…¥" class="headerlink" title="setæ–¹æ³•æ³¨å…¥"></a>setæ–¹æ³•æ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    B b;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setB</span><span class="params">(B b)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.b = b;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ¥å£æ³¨å…¥"><a href="#æ¥å£æ³¨å…¥" class="headerlink" title="æ¥å£æ³¨å…¥"></a>æ¥å£æ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InjectInterface</span>() </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InjectB</span><span class="params">(B b)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">InjectInterface</span> </span>&#123;</div><div class="line">    B b;</div><div class="line">    <span class="meta">@override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InjectB</span><span class="params">(B b)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.b = b;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ³¨è§£æ–¹å¼-ä¹Ÿæ˜¯Daggeræ¡†æ¶çš„ä¸»è¦æ–¹å¼"><a href="#æ³¨è§£æ–¹å¼-ä¹Ÿæ˜¯Daggeræ¡†æ¶çš„ä¸»è¦æ–¹å¼" class="headerlink" title="æ³¨è§£æ–¹å¼(ä¹Ÿæ˜¯Daggeræ¡†æ¶çš„ä¸»è¦æ–¹å¼)"></a>æ³¨è§£æ–¹å¼(ä¹Ÿæ˜¯Daggeræ¡†æ¶çš„ä¸»è¦æ–¹å¼)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    B b;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å…³äºDagger2çš„ä¾èµ–æ³¨å…¥ï¼Ÿ"><a href="#å…³äºDagger2çš„ä¾èµ–æ³¨å…¥ï¼Ÿ" class="headerlink" title="å…³äºDagger2çš„ä¾èµ–æ³¨å…¥ï¼Ÿ"></a>å…³äºDagger2çš„ä¾èµ–æ³¨å…¥ï¼Ÿ</h3><p>okï¼Œæˆ‘è§‰å¾—ä»–æµå¼Šçš„åœ°æ–¹æ˜¯è®¾è®¡æ€æƒ³ã€‚daggerçš„æœ€ç»ˆç›®çš„æ˜¯ä¾èµ–æ³¨å…¥ï¼Œæ˜¯è§£è€¦ï¼Œä½†æ˜¯ä»–çš„å®ç°æ–¹æ³•å¾ˆæµå¼Šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥èŠä¸€èŠä»–çš„å‡ ä¸ªkeywords: Injectï¼ŒComponentï¼ŒModuleï¼ŒProvidesï¼Œè¿™é‡Œå…è®¸æˆ‘ç›—ä¸€å¼ å›¾(ps: <a href="http://www.jianshu.com/p/cd2c1c9f68d4" target="_blank" rel="external">å›¾çš„æ¥æº</a>, è¿™ç¯‡æ–‡ç« çš„ä½œè€…å°±æ˜¯ä¸Šé¢çš„MVPçš„ä½œè€…ã€‚éå¸¸æ„Ÿè°¢å¤§å“¥ï¼Œä¹‹å‰ä¹Ÿè¯¦ç»†è§£ç­”äº†æˆ‘å¾ˆå¤š)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1504173-0b81f8a57768a703.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…³ç³»å›¾"></p>
<h4 id="Inject"><a href="#Inject" class="headerlink" title="Inject:"></a>Inject:</h4><p>ä¸¤ä¸ªä½œç”¨:</p>
<p>1.æ ‡è¯†å“ªé‡Œéœ€è¦è¢«æ³¨å…¥ã€‚</p>
<p>2.æ ‡è¯†å“ªé‡Œå¯ä»¥æä¾›æ³¨å…¥ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œéœ€è¦è¢«æ³¨å…¥</span></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    B b;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</div><div class="line">    <span class="comment">// æä¾›æ³¨å…¥</span></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    B() &#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Commponent"><a href="#Commponent" class="headerlink" title="Commponent"></a>Commponent</h4><p>å­—é¢ç†è§£å°±æ˜¯ä¸»æŒäººï¼Œå®ƒæ›´åƒæ˜¯æˆ‘ä»¬çš„åˆ†å‘å™¨ã€‚å‘è´Ÿè´£å¾—åˆ°Bçš„å®ä¾‹ï¼Œå¹¶å»ç»™è¢«æ ‡è¯†æ³¨å…¥çš„åœ°æ–¹è¿›è¡Œæ³¨å…¥ã€‚å®šç‚¹æŠ•æ”¾ã€‚æ­£æ‰€è°“æ¥é¾™å»è„‰çŸ¥é“ï¼Œæˆ‘ä»¬éœ€è¦Commponentæ¥å®ç°è¿™ä¸ªæ³¨å…¥è¿‡ç¨‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</div><div class="line">    <span class="comment">// æä¾›æ³¨å…¥</span></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    B() &#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ‰¾åˆ°Bçš„å®ä¾‹è¿›è¡Œæ³¨å…¥ï¼Œä¹Ÿå°±æ˜¯éœ€è¦Commponentæ¥å»ºç«‹è”ç³»</span></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    B b;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@Commponent</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Commponent</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™å°±æ˜¯è®©Aï¼ŒBå‘ç”Ÿè”ç³»çš„åœ°æ–¹</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Inject</span><span class="params">(A a)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹Class A</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ‰¾åˆ°Bçš„å®ä¾‹è¿›è¡Œæ³¨å…¥ï¼Œä¹Ÿå°±æ˜¯éœ€è¦Commponentæ¥å»ºç«‹è”ç³»</span></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    B b;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">A</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// Dagger2 è‡ªåŠ¨ç”Ÿæˆçš„ç»„ä»¶ç”¨æ¥æ³¨å…¥ï¼Œè¿™æ ·ä¹Ÿå°±è®©Aï¼ŒBå»ºç«‹äº†è”ç³»</span></div><div class="line">        DaggerComponent.builder()</div><div class="line">                       .build()</div><div class="line">                       .inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>è®²åˆ°è¿™é‡Œï¼Œä½ ä¼šæƒ³ï¼Œæ—¢ç„¶ç›®æ ‡ï¼Œæ¥æºéƒ½ç”¨Injectæ³¨è§£äº†ï¼Œæ³¨å…¥å™¨Commponentä¹Ÿå·²ç»okäº†ï¼Œä¸ºä½•è¦ç”¨åˆ°Modelï¼Œå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå‡å¦‚æˆ‘ä»¬é¡¹ç›®ç”¨ç¬¬ä¸‰æ–¹æˆ–è€…å…¬å¸å°è£…å¥½çš„ç±»åº“ï¼Œä½ ä¸å¯èƒ½æŒ‡æœ›ä½ å»æ‰“å¼€å®ƒå»ä¿®æ”¹ï¼Œåœ¨ä½ éœ€è¦çš„ä½ç½®åŠ ä¸ŠInjectï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨Modelï¼Œå°†ç¬¬ä¸‰æ–¹æˆ‘ä»¬éœ€è¦çš„ç±»æš´éœ²å‡ºæ¥ã€‚Moduleå…¶å®æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼ï¼ŒModuleé‡Œé¢çš„æ–¹æ³•åŸºæœ¬éƒ½æ˜¯åˆ›å»ºç±»å®ä¾‹çš„æ–¹æ³•ã€‚<br>è¿˜æ˜¯ä¸Šä»£ç æ¸…æ™°ä¸€äº›:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Model</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="comment">// B ä¸ºæˆ‘ä»¬ç¬¬ä¸‰æ–¹libä¸­çš„ç±»</span></div><div class="line">    <span class="function">B <span class="title">ProduceB</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> B();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç„¶è€Œè¿™æ ·å¹¶æ²¡æœ‰å®Œæˆï¼ŒModelä»…ä»…æ˜¯åˆ›å»ºå®ä¾‹çš„æ–¹æ³•ï¼Œæˆ‘æ²¡è¿˜æ²¡æœ‰è®©ä»–è·Ÿæˆ‘çš„Componentå‘ç”Ÿè”ç³»ï¼Œæˆ‘ä»¬éœ€è¦Modelå¯ä»¥è·Ÿæˆ‘ä¹‹å‰Injectéœ€è¦æ³¨å…¥çš„åœ°æ–¹å‘ç”Ÿè”ç³»ï¼Œæ¥ä¸‹æ¥å°±å¼•å‡ºæ¥æˆ‘ä¸‹é¢çš„keyword: Provides</p>
<h4 id="Provides"><a href="#Provides" class="headerlink" title="Provides"></a>Provides</h4><p>æ¥ç€æˆ‘ä»¬ä¸Šé¢çš„è¯é¢˜ï¼Œä¸è¦åœã€‚ä¸Šé¢è¯´åˆ°æˆ‘ä»¬éœ€è¦è®©æˆ‘çš„Modelè·Ÿæˆ‘ä»¬çš„Commponentå»ºç«‹è”ç³»ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æä¾›Providesæ ‡æ³¨æˆ‘ä»¬éœ€è¦çš„æ„é€ æ–¹æ³•ï¼Œè¿™æ ·å°±å®ç°äº†æˆ‘ä»¬çš„éœ€æ±‚ã€‚æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ã€‚ç„¶åæˆ‘ä»¬ç®€å•æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Model</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="comment">// Providesæ¥æ ‡æ³¨</span></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function">B <span class="title">ProduceB</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> B();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å…³äºModelï¼ŒInjectä¼˜å…ˆçº§ï¼Ÿ"><a href="#å…³äºModelï¼ŒInjectä¼˜å…ˆçº§ï¼Ÿ" class="headerlink" title="å…³äºModelï¼ŒInjectä¼˜å…ˆçº§ï¼Ÿ"></a>å…³äºModelï¼ŒInjectä¼˜å…ˆçº§ï¼Ÿ</h3><p>è¿™é‡ŒDagger2å¤„ç†çš„ä¼˜å…ˆçº§æ˜¯ï¼šModel &gt; Inject<br>ä¹Ÿå°±æ˜¯åœ¨åˆå§‹åŒ–æ„é€ çš„æ—¶å€™ï¼ŒDagger2ä¼šå…ˆå»æŸ¥æ‰¾Modelæœ‰æ²¡æœ‰Provideæˆ‘ä»¬éœ€è¦çš„æ„é€ æ–¹æ³•ï¼Œå‡å¦‚æ²¡æœ‰ï¼Œå®ƒä¼šå»æŸ¥æ‰¾Injectã€‚</p>
<h3 id="å…³äºæœ‰å‚æ— å‚çš„æ„é€ ï¼Ÿ"><a href="#å…³äºæœ‰å‚æ— å‚çš„æ„é€ ï¼Ÿ" class="headerlink" title="å…³äºæœ‰å‚æ— å‚çš„æ„é€ ï¼Ÿ"></a>å…³äºæœ‰å‚æ— å‚çš„æ„é€ ï¼Ÿ</h3><p>æ— å‚ç›´æ¥å°±createè¿™ä¸ªç±»ï¼Œæœ‰å‚å°±å»æŸ¥çœ‹@modelçš„@Provideï¼Œç„¶åå†æŸ¥ Inject æ¥æ„é€ æˆ‘ä»¬è¿™ä¸ªç±»éœ€è¦çš„æœ‰å‚æ„é€ çš„å‚æ•°ï¼Œè¿‡ç¨‹ä¸­å¦‚æœåˆå‘ç°è¿˜æœ‰éœ€è¦æ„é€ å‚æ•°çš„å°±ç»§ç»­æŸ¥@modelçš„@Provide  ç„¶åå†æŸ¥ Inject ä»¥æ­¤ç±»æ¨ã€‚</p>
<h2 id="ç®€å•æ€»ç»“"><a href="#ç®€å•æ€»ç»“" class="headerlink" title="ç®€å•æ€»ç»“"></a>ç®€å•æ€»ç»“</h2><p>Dagger2çš„å‡ºç°å¤§å¤§åŠ å¿«äº†Androidçš„MVPæ¨¡å¼çš„å¼€å‘ã€‚è€Œä»Šå¤©æˆ‘è¯´çš„æ˜¯åŸºç¡€æ–¹é¢çš„ï¼Œè‡³äºè¿˜æœ‰å¾ˆå¤šä¾‹å¦‚ Qualifierï¼ˆé™å®šç¬¦ï¼‰ã€Singletonï¼ˆå•ä¾‹ï¼‰ã€Scopeï¼ˆä½œç”¨åŸŸï¼‰ã€æˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„Blogä¸­è¿›è¡Œåˆ†æï¼Œç”±è¡·åœ°å¸Œæœ›æœ‰çœ‹åˆ°è¿™ç¯‡åšå®¢çš„ç«¥é‹ï¼Œå‡å¦‚å‘ç°æˆ‘çš„ç†è§£æœ‰é—®é¢˜ï¼ŒåŠæ—¶çº æ­£æˆ‘ã€‚</p>
<p>æœ€åéƒ‘é‡å£°æ˜ï¼Œæ„Ÿè°¢<a href="http://www.jianshu.com/users/2ce7b74b592b/latest_articles" target="_blank" rel="external">ç‰›å¤§å“¥</a>.</p>
]]></content>
      
        
        <tags>
            
            <tag> Android ç¬¬ä¸‰æ–¹ </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
